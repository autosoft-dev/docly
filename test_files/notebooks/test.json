{"paragraphs":[{"text":"%pyspark\n\nfrom pyspark.sql.functions import *\n\nage_data = spark.sql(\"\"\"select msisdn,lifestage_final, cast(age as int) as age, 1 as flag, subs_type from customer360.clm_mastertable where lifestyle_final not in ('inactive' ) and  subs_type = 'POST'and par_month = 202005 and age is not null \"\"\") \n\nage_data  = age_data.withColumn('age', when(col('age')<=17, lit(1))\n                                    .when(col('age').between(18,22), lit(2))\n                                    .when(col('age').between(23,26), lit(3))\n                                    .when(col('age').between(27,30), lit(4)).otherwise(0) ).filter(col('age') != 0)\n\n\n#age_data  = age_data.withColumn('age', when(col('age')<=17, lit(1))\n#                                    .when(col('age').between(18,22), lit(2))\n#                                    .when(col('age').between(23,26), lit(3))\n#                                    .when(col('age').between(27,30), lit(4))\n#                                    .when(col('age').between(31,40), lit(5))\n#                                    .when(col('age').between(41,50), lit(6))\n#                                    .when(col('age')>50, lit(7))                        )\n \nother_pred = spark.sql(\"\"\"select distinct msisdn, age, lifestage_final, 0 as flag, subs_type from customer360.clm_mastertable where lifestyle_final not in ('inactive' ) and  subs_type = 'POST' and age is null and par_month = 202005 \"\"\")\n\nother_pred_pkul = spark.read.orc('/trueanalytics/data/datasci/technical_delivery/trueyou/CLM/age_null/truemoney_seg/unknown').filter((col(\"prediction\") == 1) & (col(\"subs_type\") == \"POST\")).select('msisdn')\n\nother_pred = other_pred.join(other_pred_pkul, ['msisdn'], \"inner\")\n\n#age_data_unknown = age_data.join(other_pred.select(\"msisdn\", \"predicted_unknown\"), [\"msisdn\"], \"inner\")\n#age_data_unknown = age_data_unknown.withColumn(\"age\", zzlit(None))\n\n\n#age_data = age_data.join(age_data_unknown.select(\"msisdn\", \"predicted_unknown\"), ['msisdn'] , \"left\").where(col(\"predicted_unknown\").isNull()).drop(\"predicted_unknown\")\n\nage_data_unknown = other_pred\nage_data = age_data.unionByName(age_data_unknown)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:23+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 21: other_pred_pkul = spark.read.orc('/trueanalytics/data/datasci/technical_delivery/trueyou/CLM/age_null/truemoney_seg/unknown').filter((col(\"prediction\") == 1) & (col(\"subs_type\") == \"POST\")).select('msisdn')\nTraceback (most recent call last):\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/sql/utils.py\", line 63, in deco\n    return f(*a, **kw)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/protocol.py\", line 320, in get_return_value\n    format(target_id, \".\", name), value)\npy4j.protocol.Py4JJavaError: An error occurred while calling o2946740.filter.\n: org.apache.spark.sql.AnalysisException: cannot resolve '`subs_type`' given input columns: [msisdn, prediction];;\n'Filter ((prediction#20427173L = cast(1 as bigint)) && ('subs_type = POST))\n+- AnalysisBarrier\n      +- Relation[msisdn#20427172,prediction#20427173L] orc\n\n\tat org.apache.spark.sql.catalyst.analysis.package$AnalysisErrorAt.failAnalysis(package.scala:42)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1$$anonfun$apply$2.applyOrElse(CheckAnalysis.scala:88)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1$$anonfun$apply$2.applyOrElse(CheckAnalysis.scala:85)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$transformUp$1.apply(TreeNode.scala:289)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$transformUp$1.apply(TreeNode.scala:289)\n\tat org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:70)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:288)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$3.apply(TreeNode.scala:286)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$3.apply(TreeNode.scala:286)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$4.apply(TreeNode.scala:306)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:187)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:304)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:286)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$3.apply(TreeNode.scala:286)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$3.apply(TreeNode.scala:286)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$4.apply(TreeNode.scala:306)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:187)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapChildren(TreeNode.scala:304)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:286)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$transformExpressionsUp$1.apply(QueryPlan.scala:95)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$transformExpressionsUp$1.apply(QueryPlan.scala:95)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$1.apply(QueryPlan.scala:107)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$1.apply(QueryPlan.scala:107)\n\tat org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:70)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpression$1(QueryPlan.scala:106)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.org$apache$spark$sql$catalyst$plans$QueryPlan$$recursiveTransform$1(QueryPlan.scala:118)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan$$anonfun$2.apply(QueryPlan.scala:127)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:187)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.mapExpressions(QueryPlan.scala:127)\n\tat org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpressionsUp(QueryPlan.scala:95)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:85)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:80)\n\tat org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:127)\n\tat org.apache.spark.sql.catalyst.analysis.CheckAnalysis$class.checkAnalysis(CheckAnalysis.scala:80)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:92)\n\tat org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:105)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed$lzycompute(QueryExecution.scala:57)\n\tat org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:55)\n\tat org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:47)\n\tat org.apache.spark.sql.Dataset.<init>(Dataset.scala:172)\n\tat org.apache.spark.sql.Dataset.<init>(Dataset.scala:178)\n\tat org.apache.spark.sql.Dataset$.apply(Dataset.scala:65)\n\tat org.apache.spark.sql.Dataset.withTypedPlan(Dataset.scala:3300)\n\tat org.apache.spark.sql.Dataset.filter(Dataset.scala:1458)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:282)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:214)\n\tat java.lang.Thread.run(Thread.java:748)\n\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-5980207797386606270.py\", line 375, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 21, in <module>\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/sql/dataframe.py\", line 1242, in filter\n    jdf = self._jdf.filter(condition._jc)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 1160, in __call__\n    answer, self.gateway_client, self.target_id, self.name)\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/sql/utils.py\", line 69, in deco\n    raise AnalysisException(s.split(': ', 1)[1], stackTrace)\npyspark.sql.utils.AnalysisException: \"cannot resolve '`subs_type`' given input columns: [msisdn, prediction];;\\n'Filter ((prediction#20427173L = cast(1 as bigint)) && ('subs_type = POST))\\n+- AnalysisBarrier\\n      +- Relation[msisdn#20427172,prediction#20427173L] orc\\n\"\n"}]},"apps":[],"jobName":"paragraph_1599544340880_-876231083","id":"20200615-102110_724655177","dateCreated":"2020-09-08T12:52:20+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:103"},{"text":"%pyspark\nxx = spark.read.orc('/trueanalytics/data/datasci/technical_delivery/trueyou/CLM/age_null/truemoney_seg/unknown')\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:23+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- msisdn: string (nullable = true)\n |-- prediction: long (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1599544343088_1114188283","id":"20200630-215105_1825645064","dateCreated":"2020-09-08T12:52:23+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:104"},{"text":"%pyspark\nage_data.groupBy(\"age\").agg(count(lit(1))).show()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:23+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+--------+\n| age|count(1)|\n+----+--------+\n|null|  616796|\n|   1|  179984|\n|   3|  509989|\n|   4|  506382|\n|   2|  398495|\n+----+--------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544343209_355884323","id":"20200623-223001_460316364","dateCreated":"2020-09-08T12:52:23+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:105"},{"text":"%pyspark\nage_data_unknown.count()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:23+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"7854337\n"}]},"apps":[],"jobName":"paragraph_1599544343309_1567040132","id":"20200625-153326_1209871079","dateCreated":"2020-09-08T12:52:23+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:106"},{"text":"%pyspark\n\n# split fact and unknown\n\ndata_unknownx = age_data.filter( col(\"age\").isNull() )\ndata_factx =age_data.filter( (col(\"age\").isNotNull() ) & (col(\"age\" ) != 4) )\ndata_factx_4 = age_data.filter( (col(\"age\").isNotNull() ) & (col(\"age\" ) == 4) )\n\n# sampling postpaid\n#data_raw_post_dist = data_factx.groupBy(\"age\").agg( (count(lit(1))).alias(\"dist\") )\n#seed = data_raw_post_dist.agg( (sum(\"dist\") ).alias(\"dist\")).select(\"dist\").collect()[0][0]\nseed  = 123\nfrac = 0.9\nfractions = data_factx_4.select(\"age\").distinct().withColumn(\"fraction\", lit(frac)).rdd.collectAsMap()\ndata_factx_4 = data_factx_4.stat.sampleBy(\"age\", fractions, seed).drop(\"fraction\")\n\ndata_factx = data_factx.unionByName(data_factx_4)\nage_data = data_factx.unionByName(data_unknownx)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:23+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544343416_-905224079","id":"20200709-140541_1278238394","dateCreated":"2020-09-08T12:52:23+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:107"},{"title":"Sampling (not mandatory)","text":"%pyspark\n\n# split fact and unknown\n\ndata_unknownx = age_data.filter( col(\"age\").isNull() )\ndata_factx = age_data.filter( col(\"age\").isNotNull() )\n\n# sampling postpaid\n#data_raw_post_dist = data_factx.groupBy(\"age\").agg( (count(lit(1))).alias(\"dist\") )\n#seed = data_raw_post_dist.agg( (sum(\"dist\") ).alias(\"dist\")).select(\"dist\").collect()[0][0]\nseed  = 123\nfrac = 0.7\nfractions = data_factx.select(\"age\").distinct().withColumn(\"fraction\", lit(frac)).rdd.collectAsMap()\ndata_factx = data_factx.stat.sampleBy(\"age\", fractions, seed)\n\n\nage_data = data_factx.unionByName(data_unknownx)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:23+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544343525_-2129350498","id":"20200615-102218_1092343354","dateCreated":"2020-09-08T12:52:23+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:108"},{"text":"%pyspark\n\nfrom ultron.python.CoreML.stat.Test import Hypothesis\nfrom ultron.python.CoreML.DataManipulate import Reshape\n\nlabel_usage = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/label_keyword_hit_entropy\")\nanova_input = age_data.filter( col(\"age\").isNotNull() ).select(\"msisdn\",\"age\").join(label_usage, ['msisdn'], \"inner\")\n\nanova_input_pivot = Reshape.spread(anova_input, \"label\", ['keywordHitCountEntropy_sum', 'keywordHitCountEntropy_mean', 'keywordHitCountEntropy_std', 'keywordHitCountEntropy_min', 'keywordHitCountEntropy_max', 'keywordHitCountEntropy_med', 'keywordHitCountEntropy_q1', 'keywordHitCountEntropy_q3' ], [\"msisdn\", \"age\"])\n\ntest_col = set(anova_input_pivot.columns) ^ set([\"msisdn\", \"age\"])\nanova_output = Hypothesis(spark, anova_input_pivot).anova_test(test_col, \"age\")\n\nanova_output.repartition(1).write.format(\"csv\").option(\"header\", \"true\").save(\"anova_1234_post.csv\")","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:23+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"/home/zeppelin/.local/lib/python3.6/site-packages/scipy/stats/_distn_infrastructure.py:901: RuntimeWarning: invalid value encountered in greater\n  return (a < x) & (x < b)\n/home/zeppelin/.local/lib/python3.6/site-packages/scipy/stats/_distn_infrastructure.py:901: RuntimeWarning: invalid value encountered in less\n  return (a < x) & (x < b)\n/home/zeppelin/.local/lib/python3.6/site-packages/scipy/stats/_distn_infrastructure.py:1807: RuntimeWarning: invalid value encountered in greater_equal\n  cond2 = (x >= _b) & cond0\n"}]},"apps":[],"jobName":"paragraph_1599544343638_-499550136","id":"20200624-083848_1709284155","dateCreated":"2020-09-08T12:52:23+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:109"},{"text":"%pyspark\nage_data.count()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:24+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"25169527\n"}]},"apps":[],"jobName":"paragraph_1599544343761_-757051779","id":"20200625-202716_151046163","dateCreated":"2020-09-08T12:52:23+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:110"},{"title":"Mix data","text":"%pyspark\n\nfrom pyspark.sql.types import * \n\n\ndata = age_data\n\n# count domain (daily agg to month)\ndomain_cnt = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/dpi_domain_count_by_usr\").drop(\"flag\", \"age\", \"subs_type\")\ndata = data.join(domain_cnt, ['msisdn'], \"left\")\n\n\n# entropy call\ncall_entropy_month = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/call_entropy\").drop(\"flag\", \"age\", \"subs_type\")\ndata = data.join(call_entropy_month, ['msisdn'], \"left\")\n\n\n# product true\nproduct_true = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/cor02_product\").drop(\"flag\", \"age\", \"subs_type\", \"label\")\ndata = data.join(product_true, ['msisdn'], \"left\" )  # dummy var\n\n# graph connected comp \ngraph_conn_comp = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/graph_conn_comp\").drop(\"flag\", \"age\", \"subs_type\")\ngraph_conn_comp = graph_conn_comp.withColumnRenamed(\"id\", \"msisdn\")\ndata = data.join(graph_conn_comp, ['msisdn'], \"left\")\n\n\n# cdr interaction degree\ncdr_inter_degree = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/cdr_interaction_degree\").drop(\"flag\", \"age\", \"subs_type\")\ndata = data.join(cdr_inter_degree, ['msisdn'], \"left\")\n\n\n# cellsite popularity and index\ncellsite_pop = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/cellsite_popular\").drop(\"flag\", \"age\", \"subs_type\")\ndata = data.join(cellsite_pop, ['msisdn'], \"left\")\n\n\n# cellsite count\ncellsite_cnt = spark.read.orc( \"/user/nathaniel_net/research/age_model/data_prep/cellsite_count\").drop(\"flag\", \"age\", \"subs_type\")\ndata = data.join(cellsite_cnt, ['msisdn'], \"left\")\n\n\n#international traveller // overall\ninter_travel = spark.sql(\"select msisdn, MaxdaysToNextActiveDay from customer360.custom_detail_beha_international_traveler\").drop(\"flag\", \"age\", \"subs_type\")\ninter_travel = inter_travel.groupBy(\"msisdn\").agg(sum(\"MaxdaysToNextActiveDay\").alias(\"outOfThailand_total_days\") )\ndata = data.join(inter_travel, ['msisdn'], \"left\")\ndata = data.withColumn(\"outOfThailand_total_days\", when(col(\"outOfThailand_total_days\").isNull(), 0 ).otherwise(col(\"outOfThailand_total_days\")) )\n\n\n# geo label\n#geo_lab = spark.read.orc(\"/trueanalytics/data/enterprise/customer360/dimension_detail/geo_label_detail_poi\").filter( (col(\"par_month\") == 202001) & (col(\"label\").isin(\"school_student\", \"university_student\", \"condo_resident\", \"nightclubber\", \"government_worker\")) )\n#from ultron.python.CoreML.DataManipulate import Reshape\n\n#geo_lab_1 = Reshape.spread(geo_lab, \"label\", [ 'number_of_hours_in_poi_cat', 'number_of_distinct_days_in_poi_cat', 'max_number_of_distinct_days_in_category', \"category_prob\"], [\"msisdn\", \"par_month\"]).drop(\"par_month\")\n\ngeo_lab = spark.read.orc(\"/user/nathaniel_net/research/age_model/data_prep/geo_label_jan\")\ngeo_label_part = [\"school_student\", \"university_student\", \"condo_resident\", \"nightclubber\", \"government_worker\"]\ngeo_col = [l1 for l1 in geo_lab.columns  if any([l2 in l1 for l2 in geo_label_part])] + ['msisdn']\ndata = data.join(geo_lab.select(geo_col), ['msisdn'], \"left\")\n\n\n\n#sig_new = spark.read.orc('/trueanalytics/data/datasci/technical_delivery/trueyou/CLM/df_sig')\n#data = data.join(sig_new, ['msisdn'], \"left\")\n#sig_new_unknown_age = spark.read.orc('/trueanalytics/data/datasci/technical_delivery/trueyou/CLM/agenull_post')\n#data = data.join(sig_new_unknown_age, ['msisdn'], \"left\")\n\n\ndata = data.drop(\"par_month\")\n\n\ndata_unknown = data.filter( col(\"age\").isNull() ).drop(\"lifestage_final\")\n\ndata_fact = data.filter( col(\"age\").isNotNull() ).drop(\"lifestage_final\")\n\n\ndata_fact.cache().count() ## if not cache this, it will take long to train due to pivot + indexer\n\n#data_fact = data_fact.na.fill(0) # no time to polish missing value treatment\n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:24+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1650844\n"}]},"apps":[],"jobName":"paragraph_1599544344169_-1967113156","id":"20200615-102217_1656882294","dateCreated":"2020-09-08T12:52:24+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:111"},{"text":"%pyspark\nfrom ultron.python.CoreML.DataCharacter import MissingValueCheck\noutput = MissingValueCheck(spark, data_fact).get(data_fact.columns, True)\n#z.show(output)\n\ndata_fact.agg(mean(\"vsDegreeTotalDiffRatio\"), mean(\"vosoDegreeTotalMean\"), mean(\"vosoDegreeDiff\")).show()\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:24+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"feature":"string","missing_value_actual":"string","missing_value_proportion":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------------------------+------------------------+-------------------+\n|avg(vsDegreeTotalDiffRatio)|avg(vosoDegreeTotalMean)|avg(vosoDegreeDiff)|\n+---------------------------+------------------------+-------------------+\n|         1.8482364081979608|       46.64296607336843|  82.69420489679953|\n+---------------------------+------------------------+-------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544344277_810178422","id":"20200714-091214_711612292","dateCreated":"2020-09-08T12:52:24+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:112"},{"title":"Training data (100%) distribution","text":"%pyspark\n\n# split first train and unknown\n\nz.show(data_fact.groupBy(\"age\").count() )\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:24+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"age":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"age","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"age\tcount\n1\t179984\n3\t509989\n4\t562376\n2\t398495\n"},{"type":"TEXT","data":"\n"}]},"apps":[],"jobName":"paragraph_1599544344372_-768929421","id":"20200615-103941_567244365","dateCreated":"2020-09-08T12:52:24+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:113"},{"title":"Prep preprocess pipeline","text":"%pyspark\n\n\n# for cate columns\nsel =  ['product_mix_grp2', 'truecard_type_2grp', 'truemoney_user_flg', 'trueid_user_flg', 'voice_out_2grp', 'ARPA_3GRP', 'ARPA_GROUP', 'device_type_5grp', 'handset_brand_3grp', 'handset_brand', 'TMH_DATA_USAGE_GB_2_GRP', 'TMH_DATA_USAGE_GB_GR']\n\nfrom pyspark.ml.feature import StringIndexer\nindexers = [StringIndexer(inputCol=c, outputCol=\"{0}_indexed\".format(c)).setHandleInvalid(\"keep\") for c in sel if c != 'msisdn']\nsel_new = [i + \"_indexed\" for i in sel]\n\n\nfrom pyspark.ml.feature import OneHotEncoder\nencoders = [OneHotEncoder(dropLast=False, inputCol=indexer.getOutputCol(), outputCol=\"{0}_encoded\".format(indexer.getOutputCol())) for indexer in indexers]\nsel_new = sel_new + [i + \"_indexed_encoded\" for i in sel]\n\n\nnon_feature = [\"msisdn\", \"flag\", \"age\", \"subs_type\"]\nprint(len(data_fact.columns)-len(non_feature))  # feature count\n\nfrom pyspark.ml.linalg import Vectors\nfrom pyspark.ml.feature import VectorAssembler\n\n\nfeature_list = list(set(data_fact.columns + sel_new) ^ set(non_feature + sel))\nassembler = VectorAssembler(inputCols=feature_list, outputCol=\"features\")\n\n# Convert target into numerical categories\nfrom pyspark.ml.feature import StringIndexer\nlabelIndexer = StringIndexer(inputCol=\"age\", outputCol=\"label\")\n\nprint(feature_list)\n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:24+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"119\n['handset_brand_3grp_indexed_encoded', 'callDurationEntropy_mean', 'voiceOutDegree', 'condo_resident_max_number_of_distinct_days_in_category', 'nightclubber_category_prob', 'vsivsoDegreeTotalMeanALL', 'cellsite_cnt_distinct_day_q3', 'ARPA_6_MTHS', 'visoDegreeTotal', 'INTERNET_AMT_AVG', 'visoDegreeDiff', 'device_type_5grp_indexed', 'TMH_DATA_USAGE_GB_GR_indexed', 'vosiDegreeDiff', 'cellsite_popularity_month_q1', 'TMH_DATA_USAGE_GB_2_GRP_indexed', 'ARPA_GROUP_indexed_encoded', 'nightclubber_max_number_of_distinct_days_in_category', 'trueid_user_flg_indexed_encoded', 'product_mix_grp2_indexed', 'callDurationEntropy_q1', 'vosoDegreeDiff', 'vvDegreeDiff', 'ssDegreeTotal', 'cellsite_popularity_index_nrm_q1', 'government_worker_number_of_hours_in_poi_cat', 'cellsite_cnt_distinct_day_med', 'domain_cnt_max', 'TMH_DATA_USAGE_GB_2_GRP_indexed_encoded', 'cellsite_cnt_distinct_day_max', 'visiDegreeTotalMean', 'trueyou_point_remain', 'ARPA_3GRP_indexed', 'callDurationEntropy_min', 'condo_resident_number_of_hours_in_poi_cat', 'callDurationEntropy_sum', 'FIX_TOTAL_SUBS', 'smsOutDegree', 'truecard_type_2grp_indexed_encoded', 'nightclubber_number_of_hours_in_poi_cat', 'TVS_AMT_AVG', 'ssDegreeDiff', 'cellsite_popularity_month_sum', 'cellsite_popularity_index_nrm_std', 'government_worker_number_of_distinct_days_in_poi_cat', 'ssDegreeTotalMean', 'domain_cnt_q1', 'domain_cnt_sum', 'cellsite_popularity_month_q3', 'component', 'smsInDegree', 'truemoney_user_flg_indexed_encoded', 'callDurationEntropy_med', 'domain_cnt_mean', 'callDurationEntropy_std', 'cellsite_cnt_distinct_day_std', 'vvDegreeRatio', 'school_student_category_prob', 'visoDegreeRatio', 'cellsite_popularity_index_nrm_sum', 'vosoDegreeTotal', 'cellsite_popularity_index_nrm_max', 'voice_out_2grp_indexed', 'INTERNET_TOTAL_SUBS', 'cellsite_popularity_index_nrm_q3', 'TMH_DATA_USAGE_GB_GR_indexed_encoded', 'visiDegreeTotal', 'domain_cnt_med', 'government_worker_max_number_of_distinct_days_in_category', 'domain_cnt_min', 'cellsite_cnt_distinct_day_sum', 'TMH_VOICE_OUTGOING_DUR_MINS', 'school_student_number_of_distinct_days_in_poi_cat', 'trueid_user_flg_indexed', 'outOfThailand_total_days', 'visiDegreeDiff', 'voice_out_2grp_indexed_encoded', 'school_student_max_number_of_distinct_days_in_category', 'condo_resident_category_prob', 'handset_brand_indexed', 'cellsite_popularity_index_nrm_mean', 'ARPA_3GRP_indexed_encoded', 'nightclubber_number_of_distinct_days_in_poi_cat', 'TMH_VOICE_INCOMING_DUR_MINS', 'cellsite_popularity_month_min', 'CUR_INV_AMT', 'vosiDegreeTotalMean', 'callDurationEntropy_q3', 'TMH_DOWNLOAD_GB', 'cellsite_popularity_month_med', 'visoDegreeTotalMean', 'cellsite_cnt_distinct_day_q1', 'government_worker_category_prob', 'university_student_max_number_of_distinct_days_in_category', 'vsivsoDegreeTotalMeanIO', 'cellsite_cnt_distinct_day_mean', 'cellsite_popularity_month_max', 'ssDegreeRatio', 'sivoDegreeRatio', 'data_usage', 'vvDegreeTotalMean', 'cellsite_popularity_month_mean', 'school_student_number_of_hours_in_poi_cat', 'vsDegreeTotalDiffRatio', 'vosiDegreeTotal', 'truecard_type_2grp_indexed', 'domain_cnt_std', 'ARPA_GROUP_indexed', 'vsivsoDegreeDiff', 'vosoDegreeTotalMean', 'university_student_category_prob', 'device_type_5grp_indexed_encoded', 'cellsite_cnt_distinct_day_min', 'TVS_TOTAL_SUBS', 'handset_brand_3grp_indexed', 'cellsite_popularity_index_nrm_med', 'vvDegreeTotal', 'cellsite_popularity_index_nrm_min', 'cellsite_popularity_month_std', 'truemoney_user_flg_indexed', 'product_mix_grp2_indexed_encoded', 'TMH_UPLOAD_GB', 'university_student_number_of_hours_in_poi_cat', 'voiceInDegree', 'domain_cnt_q3', 'condo_resident_number_of_distinct_days_in_poi_cat', 'university_student_number_of_distinct_days_in_poi_cat', 'vsDegreeTotal', 'callDurationEntropy_max', 'handset_brand_indexed_encoded', 'POST_TMVH_AMT_AVG']\n"}]},"apps":[],"jobName":"paragraph_1599544344466_1459570112","id":"20200615-103341_525988420","dateCreated":"2020-09-08T12:52:24+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:114"},{"text":"%pyspark\nfrom pyspark.mllib.tree import RandomForest, RandomForestModel\nfrom pyspark.mllib.util import MLUtils\nfrom pyspark.ml.classification import RandomForestClassifier\nfrom pyspark.ml import Pipeline\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator\nfrom pyspark.ml.tuning import ParamGridBuilder, CrossValidator\nimport math as mt\n\nrf_post = RandomForestClassifier(featuresCol = 'features', labelCol = 'label',\n                                     numTrees=20, featureSubsetStrategy=\"auto\",\n                                     impurity='entropy', maxDepth=15, maxBins=20)\n                                     \n                                     \npipeline = Pipeline(stages=indexers + encoders + [labelIndexer, assembler, rf_post])\n\nparamGrid = ParamGridBuilder() \\\n    .addGrid(rf_post.numTrees, [100, 50, 80, mt.sqrt(len(data_fact.columns)*2) ] ) \\\n    .addGrid(rf_post.maxDepth, [2, 5, 10, 15 ] ) \\\n    .addGrid(rf_post.maxBins, [10, 15, 20, 25 ] ) \\\n    .build()\n\neval_multi = MulticlassClassificationEvaluator(predictionCol=\"prediction\", labelCol=\"label\", metricName=\"f1\")\n\ncrossval = CrossValidator(estimator=pipeline,\n                          estimatorParamMaps=paramGrid,\n                          evaluator=eval_multi,\n                          numFolds=5)\n\n# Run stages in pipeline and train model\n(trainingData, testData) = data_fact.randomSplit([0.7, 0.3], seed = 100)\n\n#model_postpaid = crossval.fit(data_raw_post)\n\nmodel_postpaid = pipeline.fit(trainingData)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:24+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544344589_854819906","id":"20200615-102217_790764441","dateCreated":"2020-09-08T12:52:24+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:115"},{"text":"","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:24+0700","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544344683_-780598816","id":"20200625-075559_897255842","dateCreated":"2020-09-08T12:52:24+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:116"},{"text":"%pyspark\ntrainingData.count()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:26+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"616830\n"}]},"apps":[],"jobName":"paragraph_1599544344792_260679936","id":"20200625-213117_719130025","dateCreated":"2020-09-08T12:52:24+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:117"},{"title":"Var Imp from Best Set","text":"%pyspark\n\nimport pandas as pd\nva = model_postpaid.stages[-2]\ntree = model_postpaid.stages[-1]\n\n#display(tree) #visual|ize the decision tree model\n#print(tree.toDebugString) #print the nodes of the decision tree model\n\nvar_df = pd.DataFrame(list(zip(va.getInputCols(), tree.featureImportances))) \nvar_df = var_df.sort_values(by=[1], ascending=False)\nvar_df = spark.createDataFrame(var_df)\n\nz.show(var_df.limit(100))\n\n#list(var_df.iloc[:,0])[0:1000]\n","user":"thatchaphon_kae","dateUpdated":"2020-11-12T17:49:53+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"0":"string","1":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"0","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"1","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"0\t1\nTMH_VOICE_OUTGOING_DUR_MINS\t0.08328446581032563\ncellsite_cnt_distinct_day_sum\t0.0343908116487426\nTVS_AMT_AVG\t0.032288050759127156\nPOST_TMVH_AMT_AVG\t0.030709537374140117\nvvDegreeTotalMean\t0.022034271072470607\nTMH_VOICE_INCOMING_DUR_MINS\t0.020477753863228414\ndomain_cnt_sum\t0.019863135135640142\nARPA_GROUP_indexed\t0.019443518675062624\ndomain_cnt_std\t0.019362988952641515\nuniversity_student_number_of_distinct_days_in_poi_cat\t0.017099151650472995\nINTERNET_AMT_AVG\t0.016889233083398854\nvoice_out_2grp_indexed_encoded\t0.015239140690205677\nschool_student_number_of_hours_in_poi_cat\t0.014304467837729146\ndevice_type_5grp_indexed_encoded\t0.012701869212397326\ncondo_resident_category_prob\t0.01255800094648633\nvisiDegreeTotal\t0.01182776869115792\ncellsite_popularity_month_std\t0.01047096450481361\nvisoDegreeDiff\t0.0086530254266183\nssDegreeTotalMean\t0.008099090884398098\ncellsite_popularity_month_mean\t0.008084154330438357\ntrueyou_point_remain\t0.008008671841040559\ncallDurationEntropy_std\t0.007976271458453123\nvsDegreeTotalDiffRatio\t0.007936868252976865\nTMH_DATA_USAGE_GB_GR_indexed_encoded\t0.007523991861085541\ntruemoney_user_flg_indexed_encoded\t0.007389322078281593\ncellsite_popularity_index_nrm_min\t0.00725975456020013\nproduct_mix_grp2_indexed_encoded\t0.007227493411897286\ncellsite_cnt_distinct_day_std\t0.0070789647431173455\nvisiDegreeTotalMean\t0.006721656911595806\nvsivsoDegreeTotalMeanALL\t0.0067200635796623165\nARPA_6_MTHS\t0.006359239428488398\nssDegreeRatio\t0.0063436391562487005\nINTERNET_TOTAL_SUBS\t0.006057866315393544\nnightclubber_number_of_hours_in_poi_cat\t0.00594899723709992\nvisoDegreeRatio\t0.005913970165869907\nvsDegreeTotal\t0.005862643129015067\noutOfThailand_total_days\t0.005802979213932938\nTMH_DATA_USAGE_GB_2_GRP_indexed\t0.005781272720679496\nssDegreeDiff\t0.005237313406136717\ntruecard_type_2grp_indexed_encoded\t0.005137832134638046\nvoiceInDegree\t0.005045978700529972\ntruemoney_user_flg_indexed\t0.004693863106559734\ndata_usage\t0.004648488165541436\nsmsInDegree\t0.004634037926800102\nschool_student_max_number_of_distinct_days_in_category\t0.004568872461777818\ncomponent\t0.004466923752165025\ncellsite_popularity_index_nrm_max\t0.004379320450512673\nnightclubber_number_of_distinct_days_in_poi_cat\t0.004345118514696477\ncellsite_popularity_index_nrm_mean\t0.004246012292726777\nuniversity_student_category_prob\t0.0041976256587914484\nvoice_out_2grp_indexed\t0.0041498132324388716\nnightclubber_category_prob\t0.004114545067774948\nvisiDegreeDiff\t0.004031081516890995\nnightclubber_max_number_of_distinct_days_in_category\t0.003915683173019173\nFIX_TOTAL_SUBS\t0.0037723551070086023\ndomain_cnt_med\t0.0037363616496857094\ndomain_cnt_q3\t0.0036819945593226217\nCUR_INV_AMT\t0.0035997107771450977\ncellsite_cnt_distinct_day_min\t0.003549090588158664\ncellsite_cnt_distinct_day_max\t0.003278118453131963\ncondo_resident_number_of_hours_in_poi_cat\t0.003026254109762807\ncallDurationEntropy_min\t0.002620980377006098\nTMH_DATA_USAGE_GB_GR_indexed\t0.0024424146351014336\ncallDurationEntropy_max\t0.002211090933296552\ncellsite_popularity_month_min\t0.0016969758805573522\ntrueid_user_flg_indexed\t0.0014453148656478202\nvosiDegreeTotalMean\t0.001413114167961222\ntrueid_user_flg_indexed_encoded\t0.0012316324891087163\ncallDurationEntropy_med\t0.0012040877395389797\ncellsite_popularity_index_nrm_std\t0.0011521054733452563\ncellsite_popularity_index_nrm_q1\t0.0011112275973398271\ncellsite_popularity_month_q3\t0.001045874151654388\ncellsite_cnt_distinct_day_q3\t9.96919381815227E-4\ndomain_cnt_mean\t9.850267471425427E-4\ncellsite_popularity_month_sum\t9.70886804502607E-4\nvosoDegreeTotalMean\t9.147249897883102E-4\nsivoDegreeRatio\t8.726015306632521E-4\nvosoDegreeTotal\t8.322153432442154E-4\ntruecard_type_2grp_indexed\t8.256282128585984E-4\ndomain_cnt_min\t7.823876467496619E-4\nsmsOutDegree\t7.765333917321192E-4\nTVS_TOTAL_SUBS\t7.602562595168687E-4\nARPA_GROUP_indexed_encoded\t7.473635530768827E-4\ncellsite_popularity_index_nrm_q3\t7.302969480051314E-4\ncallDurationEntropy_q3\t7.095951275876599E-4\nvsivsoDegreeDiff\t7.09572283934898E-4\ncellsite_popularity_month_q1\t7.0409809518115E-4\ncondo_resident_number_of_distinct_days_in_poi_cat\t6.585463840294854E-4\ncallDurationEntropy_sum\t6.475305470954795E-4\nhandset_brand_3grp_indexed\t6.357292159803561E-4\ngovernment_worker_number_of_distinct_days_in_poi_cat\t6.183502221077064E-4\nproduct_mix_grp2_indexed\t5.870007001228276E-4\nvosiDegreeDiff\t5.665877577248589E-4\nvosiDegreeTotal\t5.51079058472096E-4\ncellsite_popularity_month_max\t5.415243257962571E-4\nARPA_3GRP_indexed_encoded\t5.333474637946929E-4\ndomain_cnt_max\t5.152372424738536E-4\ndevice_type_5grp_indexed\t5.064165283208812E-4\ndomain_cnt_q1\t5.053004432311188E-4\nhandset_brand_indexed\t5.048280593720857E-4\n"},{"type":"TEXT","data":"\n"}]},"apps":[],"jobName":"paragraph_1599544346567_648813093","id":"20200615-102624_438871293","dateCreated":"2020-09-08T12:52:26+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:118"},{"text":"%pyspark\n\npredictions_post = model_postpaid.transform(testData)\n#predictions_post.columns\n#predictions_post.cache().count()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:26+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544346687_-1247315825","id":"20200615-110004_1250027579","dateCreated":"2020-09-08T12:52:26+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:119"},{"text":"%pyspark\nfrom pyspark.ml.evaluation import MulticlassClassificationEvaluator\n\nmodel_post_pred_perf = MulticlassClassificationEvaluator(predictionCol='prediction', labelCol='label', metricName='f1')\nmodel_post_pred_perf.evaluate(predictions_post)\n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:26+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0.500691423035585\n"}]},"apps":[],"jobName":"paragraph_1599544346793_-1671232612","id":"20200623-181319_237540586","dateCreated":"2020-09-08T12:52:26+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:120"},{"text":"%pyspark\n\npredictions_post_x = predictions_post.withColumn(\"label_original\", col(\"age\"))\nperf = predictions_post_x.select(\"label\", \"label_original\").distinct()\nperf = perf.withColumnRenamed(\"label_original\",\"label_predicted\")\n\npredictions2 = predictions_post_x.drop(\"label\")\npredictions2 = predictions2.join(perf, col(\"label\") == col(\"prediction\"), \"left\")\n\ny_true = predictions2.select(['label_original']).collect()\ny_pred = predictions2.select(['label_predicted']).collect()\n\nfrom sklearn.metrics import classification_report, confusion_matrix\nprint(classification_report(y_true, y_pred))","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:26+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"              precision    recall  f1-score   support\n\n           1       0.52      0.42      0.47     98653\n           2       0.51      0.47      0.49    224585\n           3       0.43      0.39      0.41    290313\n           4       0.55      0.66      0.60    320952\n\n    accuracy                           0.51    934503\n   macro avg       0.50      0.49      0.49    934503\nweighted avg       0.50      0.51      0.50    934503\n\n"}]},"apps":[],"jobName":"paragraph_1599544346898_-1862748018","id":"20200623-181326_1048748261","dateCreated":"2020-09-08T12:52:26+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:121"},{"text":"%pyspark\n\ndata_unknown = data_unknown.na.fill(0)\n#data_unknown = data_unknown.drop(\"age\")\n#final_model = pipeline.fit(data_unknown)\n\npredictions_unknown = model_postpaid.transform(data_unknown)\npredictions_unknown_agg = predictions_unknown.groupBy(\"prediction\").agg(count(\"prediction\").alias(\"predicted_unknown\"))\npredictions_unknown_agg = predictions_unknown_agg.withColumn(\"age\", predictions_unknown_agg[\"prediction\"].cast(IntegerType())  )\npredictions_unknown_agg = predictions_unknown_agg.select(\"age\", \"predicted_unknown\")\n\n# replace\nfrom pyspark.ml.feature import StringIndexer, StringIndexerModel\nlabel_map = {x._java_obj.getOutputCol(): x.labels for x in model_postpaid.stages if isinstance(x, StringIndexerModel)}[\"label\"]\nlabel_map = {int(k) : int(v) for k,v in enumerate(label_map)}\n\nlabel_map_df = spark.createDataFrame(list(map(list, label_map.items())), [\"age\", \"age_decode\"])\npredictions_unknown_agg = predictions_unknown_agg.join(label_map_df, [\"age\"], \"inner\")\npredictions_unknown_agg = predictions_unknown_agg.withColumn(\"age\", col(\"age_decode\")).drop(\"age_decode\")\n\ndata_fact_agg = data_fact.select(\"age\").groupBy(\"age\").agg(count(\"age\").alias(\"fact\"))\nresult = data_fact_agg.join(predictions_unknown_agg, [\"age\"], \"left\")\n \nresult.show()\n\n#max_error = result.select(\"error_raw\").max().collect()[0][0]\n#result = result.withColumn(\"error_percent\", (col(\"error_raw\") * 100) /   ) ","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:27+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+-------+-----------------+\n|age|   fact|predicted_unknown|\n+---+-------+-----------------+\n|  1| 329845|            81850|\n|  3| 969075|           458468|\n|  2| 749015|           358410|\n|  4|1071916|           716600|\n+---+-------+-----------------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544347007_1964564727","id":"20200623-181339_1452976947","dateCreated":"2020-09-08T12:52:27+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:122"},{"text":"%pyspark\nz.show(trainingData.groupBy(\"age\").count() )","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:27+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"age":"string","count":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"age\tcount\n1\t235108\n6\t1532227\n3\t690251\n5\t1921963\n4\t765790\n7\t481534\n2\t531640\n"},{"type":"TEXT","data":"\n"}]},"apps":[],"jobName":"paragraph_1599544347119_-1649515800","id":"20200625-183943_419239627","dateCreated":"2020-09-08T12:52:27+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:123"},{"text":"%python\n\nimport os\nimport psutil\nprocess = psutil.Process(os.getpid())\nprint(process.memory_info().rss)  # in bytes ","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:27+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"43663360\n"}]},"apps":[],"jobName":"paragraph_1599544347222_1835668821","id":"20200625-213554_629939812","dateCreated":"2020-09-08T12:52:27+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:124"},{"text":"%pyspark\ncol_sel_imp = ['nightclubber_category_prob',\n'domain_cnt_sum',\n'ARPA_6_MTHS',\n'truemoney_user_flg',\n'university_student_category_prob',\n'condo_resident_number_of_distinct_days_in_poi_cat',\n'cellsite_cnt_distinct_day_std',\n'nightclubber_number_of_distinct_days_in_poi_cat',\n'condo_resident_number_of_hours_in_poi_cat',\n'cellsite_popularity_month_max',\n'university_student_number_of_distinct_days_in_poi_cat',\n'government_worker_number_of_distinct_days_in_poi_cat',\n'domain_cnt_std',\n'TMH_UPLOAD_GB',\n'cellsite_cnt_distinct_day_q3',\n'school_student_number_of_distinct_days_in_poi_cat',\n'TMH_DOWNLOAD_GB',\n'vvDegreeRatio',\n'handset_brand',\n'cellsite_cnt_distinct_day_sum',\n'domain_cnt_min',\n'callDurationEntropy_min',\n'domain_cnt_q1',\n'cellsite_popularity_index_nrm_max',\n'domain_cnt_max',\n'callDurationEntropy_std',\n'cellsite_popularity_month_min',\n'cellsite_popularity_index_nrm_std',\n'cellsite_popularity_month_q3',\n'cellsite_popularity_index_nrm_q1',\n'cellsite_cnt_distinct_day_mean',\n'vvDegreeDiff',\n'cellsite_popularity_month_med',\n'cellsite_popularity_index_nrm_q3',\n'voiceOutDegree',\n'cellsite_popularity_index_nrm_sum',\n'TMH_VOICE_OUTGOING_DUR_MINS',\n'trueyou_point_remain',\n'CUR_INV_AMT',\n'data_usage',\n'POST_TMVH_AMT_AVG',\n'school_student_category_prob',\n'TMH_VOICE_INCOMING_DUR_MINS',\n'cellsite_popularity_month_std',\n'government_worker_number_of_hours_in_poi_cat',\n'cellsite_popularity_month_sum',\n'cellsite_popularity_index_nrm_min',\n'callDurationEntropy_sum',\n'cellsite_cnt_distinct_day_max',\n'voiceInDegree',\n'cellsite_popularity_month_q1',\n'truecard_type_2grp',\n'voice_out_2grp',\n'domain_cnt_mean']+ ['msisdn', 'flag' ,'subs_type', 'age']\n\"\"\" + ['beha_social_photo_feed_usage_v1_lst3m',\n'truemoney_user_flg',\n'beha_social_instant_message_usage_lst3m',\n'inte_gaming_portal_platform_lst3m',\n'inte_entertainment_music_streaming_v1_lst3m',\n'inte_courier_food_service_v1_lst3m',\n'beha_online_forum_community_lst3m',\n'handset_brand',\n'beha_bank_app_usage_v1_lst3m',\n'data_usage',\n'beha_social_video_feed_usage_lst3m',\n'inte_acedemic_institute_lst3m',\n'inte_audio_platform_streamer_lst3m',\n'beha_bank_app_usage_lst3m',\n'beha_credit_card_app_usage_lst3m',\n'TMH_UPLOAD_GB',\n'trueyou_point_remain',\n'inte_gaming_portal_platform_may',\n'domain_cnt_std',\n'ARPA_6_MTHS',\n'condo_resident_number_of_distinct_days_in_poi_cat',\n'TMH_VOICE_OUTGOING_DUR_MINS',\n'TVS_AMT_AVG',\n'TMH_DOWNLOAD_GB',\n'CUR_INV_AMT',\n'truecard_type_2grp',\n'university_student_category_prob',\n'POST_TMVH_AMT_AVG',\n'beha_bank_app_usage_v1_may',\n'domain_cnt_max',\n'vvDegreeTotalMean',\n'school_student_number_of_distinct_days_in_poi_cat',\n'voiceOutDegree',\n'cellsite_cnt_distinct_day_std',\n'cellsite_popularity_index_nrm_max',\n'university_student_number_of_distinct_days_in_poi_cat',\n'cellsite_popularity_month_max',\n'domain_cnt_sum',\n'callDurationEntropy_sum',\n'inte_education_university_student_v1_lst3m',\n'product_mix_grp2',\n'TMH_VOICE_INCOMING_DUR_MINS',\n'government_worker_number_of_hours_in_poi_cat',\n'cellsite_cnt_distinct_day_q3',\n'school_student_category_prob',\n'voiceInDegree',\n'domain_cnt_med',\n'callDurationEntropy_std',\n'government_worker_number_of_distinct_days_in_poi_cat',\n'domain_cnt_q3',\n'trueid_user_flg',\n'cellsite_cnt_distinct_day_sum',\n'cellsite_popularity_index_nrm_min',\n'nightclubber_category_prob',\n'nightclubber_number_of_distinct_days_in_poi_cat',\n'callDurationEntropy_min',\n'vvDegreeRatio',\n'cellsite_cnt_distinct_day_mean',\n'beha_bank_app_usage_may',\n'TMH_DATA_USAGE_GB_2_GRP',\n'cellsite_cnt_distinct_day_med',\n'condo_resident_max_number_of_distinct_days_in_category',\n'cellsite_popularity_month_std',\n'TVS_TOTAL_SUBS',\n'condo_resident_number_of_hours_in_poi_cat',\n'ARPA_GROUP',\n'FIX_TOTAL_SUBS',\n'inte_audio_platform_streamer_may',\n'TMH_DATA_USAGE_GB_GR',\n'outOfThailand_total_days'] \"\"\"\n \n # remove dpi\nrem_dpi = [l1 for l1 in list(set(col_sel_imp))  if not any([l2 in l1 for l2 in [\"inte_\", \"beha_\"] ])]\ncol_sel_imp = rem_dpi\n \n(trainingData, testData) = data_fact.select(*col_sel_imp).randomSplit([0.7, 0.3], seed = 100)\n\n#data_unknown = data_unknown.na.fill(0)\ndata_unknown_fillter = data_unknown.select(*col_sel_imp)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:27+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544347325_-822889650","id":"20200626-203601_2104412217","dateCreated":"2020-09-08T12:52:27+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:125"},{"text":"%pyspark\n\ncol_sel_imp = ['nightclubber_category_prob',\n'domain_cnt_sum',\n'ARPA_6_MTHS',\n'truemoney_user_flg',\n'university_student_category_prob',\n'condo_resident_number_of_distinct_days_in_poi_cat',\n'cellsite_cnt_distinct_day_std',\n'nightclubber_number_of_distinct_days_in_poi_cat',\n'condo_resident_number_of_hours_in_poi_cat',\n'cellsite_popularity_month_max',\n'university_student_number_of_distinct_days_in_poi_cat',\n'government_worker_number_of_distinct_days_in_poi_cat',\n'domain_cnt_std',\n'TMH_UPLOAD_GB',\n'school_student_number_of_distinct_days_in_poi_cat',\n'TMH_DOWNLOAD_GB',\n'vvDegreeRatio',\n'handset_brand',\n'cellsite_cnt_distinct_day_sum',\n'domain_cnt_min',\n'callDurationEntropy_min',\n'domain_cnt_q1',\n'cellsite_popularity_index_nrm_max',\n'domain_cnt_max',\n'callDurationEntropy_std',\n'cellsite_cnt_distinct_day_mean',\n'vvDegreeDiff',\n'voiceOutDegree',\n'TMH_VOICE_OUTGOING_DUR_MINS',\n'trueyou_point_remain',\n'CUR_INV_AMT',\n'data_usage',\n'POST_TMVH_AMT_AVG',\n'school_student_category_prob',\n'TMH_VOICE_INCOMING_DUR_MINS',\n'government_worker_number_of_hours_in_poi_cat',\n'cellsite_popularity_month_sum',\n'cellsite_popularity_index_nrm_min',\n'cellsite_cnt_distinct_day_max',\n'voiceInDegree',\n'truecard_type_2grp',\n'voice_out_2grp',\n'domain_cnt_mean'] +  ['msisdn', 'flag' ,'subs_type', 'age']\n\n \n(trainingData, testData) = data_fact.select(*col_sel_imp).randomSplit([0.7, 0.3], seed = 100)\n\n#data_unknown = data_unknown.na.fill(0)\ndata_unknown_fillter = data_unknown.select(*col_sel_imp)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:27+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544347716_-1476870495","id":"20200709-133513_142351364","dateCreated":"2020-09-08T12:52:27+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:126"},{"text":"%pyspark\ncol_sel_imp","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:27+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"['nightclubber_category_prob', 'condo_resident_max_number_of_distinct_days_in_category', 'ARPA_6_MTHS', 'vvDegreeDiff', 'domain_cnt_max', 'trueyou_point_remain', 'cellsite_cnt_distinct_day_max', 'flag', 'condo_resident_number_of_hours_in_poi_cat', 'FIX_TOTAL_SUBS', 'cellsite_popularity_index_nrm_std', 'domain_cnt_q1', 'domain_cnt_mean', 'callDurationEntropy_std', 'vvDegreeRatio', 'school_student_category_prob', 'cellsite_popularity_index_nrm_sum', 'cellsite_popularity_index_nrm_q3', 'TMH_DATA_USAGE_GB_GR', 'product_mix_grp2', 'cellsite_cnt_distinct_day_sum', 'domain_cnt_min', 'school_student_number_of_distinct_days_in_poi_cat', 'outOfThailand_total_days', 'TMH_VOICE_INCOMING_DUR_MINS', 'TMH_DOWNLOAD_GB', 'cellsite_popularity_month_max', 'vvDegreeTotalMean', 'university_student_category_prob', 'TVS_TOTAL_SUBS', 'TMH_UPLOAD_GB', 'voiceInDegree', 'university_student_number_of_distinct_days_in_poi_cat', 'POST_TMVH_AMT_AVG', 'voiceOutDegree', 'cellsite_cnt_distinct_day_q3', 'cellsite_popularity_month_q1', 'truecard_type_2grp', 'subs_type', 'cellsite_popularity_index_nrm_q1', 'government_worker_number_of_hours_in_poi_cat', 'cellsite_cnt_distinct_day_med', 'callDurationEntropy_min', 'callDurationEntropy_sum', 'TVS_AMT_AVG', 'cellsite_popularity_month_sum', 'government_worker_number_of_distinct_days_in_poi_cat', 'domain_cnt_sum', 'TMH_DATA_USAGE_GB_2_GRP', 'cellsite_popularity_month_q3', 'handset_brand', 'cellsite_cnt_distinct_day_std', 'cellsite_popularity_index_nrm_max', 'domain_cnt_med', 'voice_out_2grp', 'TMH_VOICE_OUTGOING_DUR_MINS', 'nightclubber_number_of_distinct_days_in_poi_cat', 'cellsite_popularity_month_min', 'CUR_INV_AMT', 'cellsite_popularity_month_med', 'cellsite_cnt_distinct_day_mean', 'msisdn', 'data_usage', 'domain_cnt_std', 'trueid_user_flg', 'ARPA_GROUP', 'cellsite_popularity_month_std', 'cellsite_popularity_index_nrm_min', 'truemoney_user_flg', 'age', 'domain_cnt_q3', 'condo_resident_number_of_distinct_days_in_poi_cat']\n"}]},"apps":[],"jobName":"paragraph_1599544347819_1677108837","id":"20200709-133104_50988523","dateCreated":"2020-09-08T12:52:27+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:127"},{"text":"%pyspark\ntrainingData = data_fact.select(*col_sel_imp)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:27+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544347911_-258762656","id":"20200630-151136_1083485669","dateCreated":"2020-09-08T12:52:27+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:128"},{"text":"%pyspark\n(trainingData, testData) = data_fact.randomSplit([0.7, 0.3], seed = 100)\n\ndata_unknown_fillter = data_unknown","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:28+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544348013_55756987","id":"20200629-154115_1056690603","dateCreated":"2020-09-08T12:52:28+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:129"},{"text":"%pyspark\ntrainingData\n\nfrom pyspark.ml.feature import PCA\n\ndataPCA = PCA(k=30, inputCol=\"features\", outputCol=\"featurespca\")\nmodel = dataPCA.fit(data)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:28+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544348156_-440001323","id":"20200627-113551_1408219955","dateCreated":"2020-09-08T12:52:28+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:130"},{"text":"%pyspark\n\ntrain_pd = trainingData.toPandas()\n#test_pd = testData.toPandas()\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:28+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544348249_383492824","id":"20200623-192937_603392328","dateCreated":"2020-09-08T12:52:28+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:131"},{"text":"%pyspark\ntrainingData.count()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:28+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2218889\n"}]},"apps":[],"jobName":"paragraph_1599544348415_912014308","id":"20200630-220746_21082480","dateCreated":"2020-09-08T12:52:28+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:132"},{"text":"%pyspark\ndel test_pd\ndel train_pd","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:28+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544348809_1279523696","id":"20200626-203402_618149075","dateCreated":"2020-09-08T12:52:28+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:133"},{"text":"%pyspark\ndata_unknown_pd = data_unknown_fillter.toPandas()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:28+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544348902_1987925230","id":"20200624-131522_1952900232","dateCreated":"2020-09-08T12:52:28+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:134"},{"text":"%pyspark\ndel data_unknown_pd","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:29+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544349006_2086249452","id":"20200630-115252_202475635","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:135"},{"text":"%pyspark\n\nimport matplotlib.pyplot as plt; plt.rcdefaults()\nplt.switch_backend('agg')\n\n\ndef show(p):\n    img = io.StringIO()\n    p.savefig(img, format='svg')\n    img.seek(0)\n    print (\"%html <div style='width:600px'>\" + img.getvalue() + \"</div>\")\n\n\nimport seaborn as sns\n\nembedding = ovo_rf.transform(X2)\n\nplt.scatter(\n    embedding[:, 0],\n    embedding[:, 1],\n    c=[sns.color_palette()[x] for x in y2.age.map({\"1\":0, \"2\":1, \"3\":2, \"4\":3, \"5\":4})])\nplt.gca().set_aspect('equal', 'datalim')\nplt.title('UMAP projection 2 dims', fontsize=24)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:29+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544349109_294126940","id":"20200624-235358_1708724208","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:136"},{"title":"CV","text":"%pyspark\n\nimport numpy as np\nfrom sklearn import datasets\n\ntrain_pd_new = train_pd.drop(['msisdn', 'flag', 'subs_type'], axis=1, inplace = False)\ntest_pd_new = test_pd.drop(['msisdn', 'flag', 'subs_type'], axis=1, inplace = False)\n\nsel =  ['product_mix_grp2', 'truecard_type_2grp', 'truemoney_user_flg', 'trueid_user_flg', 'voice_out_2grp', 'ARPA_3GRP', 'ARPA_GROUP', 'device_type_5grp', 'handset_brand_3grp', 'handset_brand', 'TMH_DATA_USAGE_GB_2_GRP', 'TMH_DATA_USAGE_GB_GR']\n\nfor i in sel:\n    train_pd_new[i] = train_pd_new[i].astype('str') \n    test_pd_new[i] = test_pd_new[i].astype('str') \n\nX2 = train_pd_new.drop(['age'], axis=1, inplace = False)\ny2 = train_pd_new['age']\n\ntX2 = test_pd_new.drop(['age'], axis=1, inplace = False)\nty2 = test_pd_new['age']\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.datasets import make_classification\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.multiclass import OneVsOneClassifier\nfrom sklearn.preprocessing import OneHotEncoder, LabelEncoder\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.compose import ColumnTransformer\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\n\nfrom sklearn.model_selection import cross_val_score\n\n\n\nnumeric_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='median')),\n    ('scaler', StandardScaler())])\n\n\ncategorical_transformer = Pipeline(steps=[('imputer', SimpleImputer(strategy='constant', fill_value='missing')),  ('onehot', OneHotEncoder(handle_unknown='ignore'))])\n    \npreprocessor = ColumnTransformer( transformers=[ (\"num\", numeric_transformer, list(set(sel) ^ set(list(X2))) ) ,  ('cat',categorical_transformer  , sel)  ])\n\n\npipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(RandomForestClassifier(max_depth = 50, criterion='entropy', random_state=0, n_jobs=-1, class_weight=\"balanced\") ) ) ])\n\n#ovo_rf_umap = pipe.fit(X2, y2)\n\nscores = cross_val_score(pipe, X2, y2, cv=5)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:29+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544349211_1141388287","id":"20200624-235217_1291543117","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:137"},{"title":"CV performance","text":"%pyspark\nscores","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:29+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"array([0.47788226, 0.48042648, 0.48097101, 0.47872423, 0.48222939,\n       0.48079255, 0.48094813, 0.47966687, 0.47888658, 0.48086797])\n"}]},"apps":[],"jobName":"paragraph_1599544349318_-581398630","id":"20200625-122954_710801143","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:138"},{"text":"%pyspark\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:29+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"['truemoney_user_flg', 'handset_brand', 'data_usage', 'TMH_UPLOAD_GB', 'trueyou_point_remain', 'ARPA_6_MTHS', 'condo_resident_number_of_distinct_days_in_poi_cat', 'TMH_VOICE_OUTGOING_DUR_MINS', 'TVS_AMT_AVG', 'TMH_DOWNLOAD_GB', 'CUR_INV_AMT', 'truecard_type_2grp', 'university_student_category_prob', 'POST_TMVH_AMT_AVG', 'vvDegreeTotalMean', 'school_student_number_of_distinct_days_in_poi_cat', 'voiceOutDegree', 'cellsite_popularity_index_nrm_max', 'university_student_number_of_distinct_days_in_poi_cat', 'cellsite_popularity_month_max', 'domain_cnt_sum', 'callDurationEntropy_sum', 'product_mix_grp2', 'TMH_VOICE_INCOMING_DUR_MINS', 'government_worker_number_of_hours_in_poi_cat', 'school_student_category_prob', 'voiceInDegree', 'callDurationEntropy_std', 'government_worker_number_of_distinct_days_in_poi_cat', 'trueid_user_flg', 'cellsite_cnt_distinct_day_sum', 'nightclubber_category_prob', 'nightclubber_number_of_distinct_days_in_poi_cat', 'callDurationEntropy_min', 'vvDegreeRatio', 'cellsite_cnt_distinct_day_mean', 'TMH_DATA_USAGE_GB_2_GRP', 'condo_resident_max_number_of_distinct_days_in_category', 'TVS_TOTAL_SUBS', 'condo_resident_number_of_hours_in_poi_cat', 'ARPA_GROUP', 'FIX_TOTAL_SUBS', 'TMH_DATA_USAGE_GB_GR', 'outOfThailand_total_days', 'msisdn', 'flag', 'subs_type', 'age', 'msisdn']\n"}]},"apps":[],"jobName":"paragraph_1599544349422_-617698248","id":"20200630-115008_861114321","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:139"},{"title":"Split test","text":"%pyspark\n\nimport numpy as np\nfrom sklearn import datasets\n\n\ntrain_pd_new = train_pd.drop(['msisdn', 'flag', 'subs_type'] , axis=1, inplace = False)\ntest_pd = train_pd\ntest_pd_new = test_pd.drop(['msisdn', 'flag', 'subs_type'], axis=1, inplace = False)\n\n#sel =  ['product_mix_grp2', 'truecard_type_2grp', 'truemoney_user_flg', 'trueid_user_flg', 'voice_out_2grp', 'ARPA_3GRP', 'ARPA_GROUP', 'device_type_5grp', 'handset_brand_3grp', 'handset_brand', 'TMH_DATA_USAGE_GB_2_GRP', 'TMH_DATA_USAGE_GB_GR']\n\n#sel =   ['product_mix_grp2', 'truecard_type_2grp', 'truemoney_user_flg', 'trueid_user_flg', 'ARPA_GROUP', 'handset_brand', 'TMH_DATA_USAGE_GB_2_GRP', 'TMH_DATA_USAGE_GB_GR'] + ['voice_out_2grp']\n\nsel =   ['truecard_type_2grp', 'voice_out_2grp', 'truemoney_user_flg', 'handset_brand']\n\nfor i in sel:\n    train_pd_new[i] = train_pd_new[i].astype('str') \n    test_pd_new[i] = test_pd_new[i].astype('str') \n\nX2 = train_pd_new.drop(['age'], axis=1, inplace = False)\ny2 = train_pd_new['age']\n\ntX2 = test_pd_new.drop(['age'], axis=1, inplace = False)\nty2 = test_pd_new['age']\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.datasets import make_classification\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.multiclass import OneVsOneClassifier\nfrom sklearn.preprocessing import OneHotEncoder, LabelEncoder\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.compose import ColumnTransformer\n#from sklearn_pandas import DataFrameMapper\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\n\nfrom sklearn.decomposition import PCA\n\npca = PCA(n_components=10) #  ('dim_reduc', pca) ,\n\n\n#from umap import UMAP\nfrom lightgbm import LGBMClassifier\n\n\nnumeric_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='median')),\n    ('scaler', StandardScaler())])\n\n\ncategorical_transformer = Pipeline(steps=[('imputer', SimpleImputer(strategy='constant', fill_value='missing')),  ('onehot', OneHotEncoder(handle_unknown='ignore'))])\n    \npreprocessor = ColumnTransformer( transformers=[ (\"num\", numeric_transformer, list(set(sel) ^ set(list(X2))) ) ,  ('cat',categorical_transformer  , sel)  ])\n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LogisticRegression()) ) ])\n#umap = UMAP(random_state=456, n_components = 50, n_neighbors= 9)\n\n#### BEST \n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LGBMClassifier(subsample=0.5, importance_type='split', num_leaves=40, n_estimators=100, max_leaf_nodes=None , max_depth = 25, random_state=0, n_jobs=-1) ) ) ]) #   class_weight=\"balanced\",  colsample_bytree =0.7\n\n\n\n\n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LGBMClassifier(subsample=0.5, importance_type='split', num_leaves=40, n_estimators=100, max_leaf_nodes=None , max_depth = 25, random_state=0, n_jobs=-1, colsample_bytree =0.4) ) ) ]) #   class_weight=\"balanced\",  \n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LogisticRegression()) ) ])\n\n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LGBMClassifier(subsample=0.5,importance_type='split', num_leaves=30, n_estimators=150, max_leaf_nodes=None , max_depth = 15, random_state=0, n_jobs=-1, boosting = 'dart' , colsample_bytree =0.3, learning_rate = 0.9, ) ) ) ]) #  class_weight=\"balanced\"\n\n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(RandomForestClassifier(max_leaf_nodes=20, criterion='entropy', random_state=0, n_jobs=-1, class_weight=\"balanced\") ) ) ])\n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LGBMClassifier( importance_type='split', n_estimators=200, random_state=0, n_jobs=-1, class_weight=\"balanced\") ) ) ]) #  \n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LGBMClassifier(importance_type='split', num_leaves=40, n_estimators=70, max_leaf_nodes=None , max_depth = 25, random_state=0, n_jobs=-1) ) ) ]) #   class_weight=\"balanced\",  colsample_bytree =0.7\n\n\n########## BEST\npipe = Pipeline([  (\"preprocess\", preprocessor) , ('model', LGBMClassifier(subsample=0.5, importance_type='split', num_leaves=40, n_estimators=100, max_leaf_nodes=None , max_depth = 25, random_state=0, n_jobs=-1) ) ]) #   class_weight=\"balanced\",  colsample_bytree =0.7\n\n\n#clf2 = pipe.fit(X2, y2)\novo_rf_umap = pipe.fit(X2, y2)\n\n\n# n_estimators=20, max_leaf_nodes=20 ","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:29+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544349755_486955455","id":"20200624-102210_1890371879","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:140"},{"text":"%pyspark\novo_rf_umap","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:29+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Pipeline(steps=[('preprocess',\n                 ColumnTransformer(transformers=[('num',\n                                                  Pipeline(steps=[('imputer',\n                                                                   SimpleImputer(strategy='median')),\n                                                                  ('scaler',\n                                                                   StandardScaler())]),\n                                                  ['cellsite_cnt_distinct_day_sum',\n                                                   'domain_cnt_min',\n                                                   'voiceOutDegree',\n                                                   'TMH_VOICE_OUTGOING_DUR_MINS',\n                                                   'nightclubber_category_prob',\n                                                   'school_student_number_of_distinct_days_in_poi_cat',\n                                                   'ARPA_6_MTHS...\n                                                   'cellsite_cnt_distinct_day_std', ...]),\n                                                 ('cat',\n                                                  Pipeline(steps=[('imputer',\n                                                                   SimpleImputer(fill_value='missing',\n                                                                                 strategy='constant')),\n                                                                  ('onehot',\n                                                                   OneHotEncoder(handle_unknown='ignore'))]),\n                                                  ['truecard_type_2grp',\n                                                   'voice_out_2grp',\n                                                   'truemoney_user_flg',\n                                                   'handset_brand'])])),\n                ('model',\n                 LGBMClassifier(max_depth=25, max_leaf_nodes=None,\n                                num_leaves=40, random_state=0,\n                                subsample=0.5))])\n"}]},"apps":[],"jobName":"paragraph_1599544349857_-2122491888","id":"20200713-105231_96724748","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:141"},{"text":"%pyspark\nimport pandas as pd\nxx = ovo_rf_umap.predict(X2)\nclass_lab = pd.DataFrame(xx, columns = ['class'])","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544349947_-1202474689","id":"20200709-160956_1973000268","dateCreated":"2020-09-08T12:52:29+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:142"},{"text":"%pyspark\novo_decision = ovo_rf_umap.decision_function(X2)\n\nvotes = np.round(ovo_decision)\nnormalized_confidences = ovo_decision - votes\n\nfff = pd.DataFrame(normalized_confidences, columns = ['1', '2', '3', '4'])\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 1: ovo_decision = ovo_rf_umap.decision_function(X2)\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-5980207797386606270.py\", line 375, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 1, in <module>\n  File \"/home/zeppelin/.local/lib/python3.6/site-packages/sklearn/utils/metaestimators.py\", line 113, in __get__\n    getattr(delegate, self.attribute_name)\nAttributeError: 'LGBMClassifier' object has no attribute 'decision_function'\n"}]},"apps":[],"jobName":"paragraph_1599544350042_-535184531","id":"20200709-133854_1638231220","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:143"},{"text":"%pyspark\nvotes = np.round(ovo_decision)\nnormalized_confidences = ovo_decision - votes\nqwe = pd.DataFrame(normalized_confidences, columns = ['1', '2', '3', '4'])\n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544350139_461557252","id":"20200709-210208_314971637","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:144"},{"text":"%pyspark\n\nfff = pd.DataFrame(normalized_confidences, columns = ['1', '2', '3', '4'])\nfff['1'] += 4\nfff['2'] += 4\nfff['3'] += 4\nfff['4'] += 4\n\nclass_lab = pd.DataFrame(xx, columns = ['class'])\n#fff = pd.DataFrame(ovo_decision, columns = ['1', '2', '3', '4'])\nfff=fff.reset_index(drop=True)\nclass_lab = class_lab.reset_index(drop=True)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544350231_196049386","id":"20200709-172433_664122184","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:145"},{"text":"%pyspark\nimport pandas as pd\nx = fff.join(class_lab, how = \"inner\")\nx\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"                1         2         3         4  class\n0        3.771262  3.878023  4.137395  4.224499      4\n1        3.767746  3.880368  4.153947  4.222198      4\n2        3.773066  3.903621  4.146348  4.212425      3\n3        3.773041  3.905357  4.146138  4.212096      3\n4        3.783544  3.890626  4.130767  4.209639      4\n...           ...       ...       ...       ...    ...\n1097842  3.754414  3.847473  4.175393  4.238955      4\n1097843  3.753897  3.858862  4.186447  4.231903      4\n1097844  3.752721  3.876381  4.185719  4.229324      3\n1097845  3.751450  3.859876  4.193817  4.231323      4\n1097846  3.753344  3.861358  4.181335  4.234268      4\n\n[1097847 rows x 5 columns]\n"}]},"apps":[],"jobName":"paragraph_1599544350316_-817604730","id":"20200709-154905_849012080","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:146"},{"text":"%pyspark\n\nss =x# x[x[\"class\"] == 4]\n\nss[['1', '2', '3','4']].plot.kde()\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"<matplotlib.axes._subplots.AxesSubplot object at 0x7ff16f561748>\n"},{"type":"HTML","data":"<div style='width:auto;height:auto'><img src=data:image/png;base64,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V8ByqkUoIiJpQAFL0kJXvsLpUItQREY307T33312X1+yKGBJWoiasRksuluEEbUIRWSU8fv9NDQ02DbEmKZJQ0MDfr8/1UtJOd1FKGnB6PrLpGcFS/tgichoU1FRQVVVFXV1daleSr/8fj8VFRWpXkbKKWBJWuiewXL0POzZnr/BiYgkisfjYdKkSalehgyCWoSSFnpu0+DuPipHFSwREbEnBSxJCwcNuXdXsBSwRETEnhSwJC10z2A5wau7CEVExOZGTcCKRqPMmzePM844A4AdO3awaNEipk6dyooVKwiFQileoQyk50ajahGKiIjdjZqAdeONNzJjxozuz6+88kouv/xy3nvvPQoKCrj99ttTuDo5nAMVLOuwZ4cDIgpYIiJiU6MiYFVVVfHEE09wySWXANY+HevWreO8884DYOXKlTzyyCOpXKIcRs9tGhxdWzWE1CIUERGbGhUB69vf/jY33HADTqf1x21oaCA/Px+329qloqKigurq6lQuUQ4jVqxyOaz2oNflVItQRERsa8QHrMcff5zS0lLmz59/RN+/Zs0aFixYwIIFC2y9sdtI13PIHcDtcihgiYiIbY34jUbXr1/PY489xpNPPkkgEKClpYXLLruM5uZmIpEIbrebqqoqysvL+/z+VatWsWrVKgAWLFiQzKVLDz03GgXwuJy6i1BERGxrxFewrr/+eqqqqti5cycPPPAAH/vYx7j33ntZvHgxDz30EABr167lrLPOSvFKZSAHziJUi1BEROxvxAes/vz85z/n17/+NVOnTqWhoYGLL7441UuSAfTcaBTUIhQREXsb8S3Cnk477TROO+00ACZPnsyGDRtSuyAZtAMtQutzj8tJRC1CERGxqVFbwZL00vMsQqBrmwZVsERExJ4UsCQtxO4idHRv06AWoYiI2JcClqQFo9eQu1tD7iIiYmMKWJIWYkPuru5tGhzapkFERGxLAUvSQmwGy9FjyF0VLBERsSsFLEkLhqF9sEREJH0oYEla6N0idLschCNqEYqIiD0pYElaiJp9tAgNVbBERMSeFLAkLRiGidPRc5sGtQhFRMS+FLAkLRim2T1/BWoRioiIvSlgSVqImmZ39Qq6jspRi1BERGxKAUvSgmGY3QPu0HVUTkQBS0RE7EkBS9KCYXJQi9DrdmqjURERsS0FLEkLUcOkRwELt1NnEYqIiH0p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 style='width=auto;height:auto'><div>\n"}]},"apps":[],"jobName":"paragraph_1599544350621_-617671020","id":"20200709-161512_1968253783","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:147"},{"title":"Final model","text":"%pyspark\n\nimport numpy as np\nfrom sklearn import datasets\n\n\nfullset = train_pd.append(test_pd)\n\nfullset_new = fullset.drop(['msisdn', 'flag', 'subs_type'], axis=1, inplace = False)\n\nsel =  ['product_mix_grp2', 'truecard_type_2grp', 'truemoney_user_flg', 'trueid_user_flg', 'voice_out_2grp', 'ARPA_3GRP', 'ARPA_GROUP', 'device_type_5grp', 'handset_brand_3grp', 'handset_brand', 'TMH_DATA_USAGE_GB_2_GRP', 'TMH_DATA_USAGE_GB_GR']\n\nfor i in sel:\n    fullset_new[i] = fullset_new[i].astype('str') \n\nfull_x = fullset_new.drop(['age'], axis=1, inplace = False)\nfull_y = fullset_new['age']\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.datasets import make_classification\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.multiclass import OneVsOneClassifier\nfrom sklearn.preprocessing import OneHotEncoder, LabelEncoder\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.compose import ColumnTransformer\n#from sklearn_pandas import DataFrameMapper\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\n\n\n#from umap import UMAP\nfrom lightgbm import LGBMClassifier\n\n\nnumeric_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='median')),\n    ('scaler', StandardScaler())])\n\n\ncategorical_transformer = Pipeline(steps=[('imputer', SimpleImputer(strategy='constant', fill_value='missing')),  ('onehot', OneHotEncoder(handle_unknown='ignore'))])\n    \npreprocessor = ColumnTransformer( transformers=[ (\"num\", numeric_transformer, list(set(sel) ^ set(list(X2))) ) ,  ('cat',categorical_transformer  , sel)  ])\n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LogisticRegression()) ) ])\n#umap = UMAP(random_state=456, n_components = 50, n_neighbors= 9)\n\npipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(RandomForestClassifier(max_depth = 50, criterion='entropy', random_state=0, n_jobs=-1, class_weight=\"balanced\") ) ) ])\n\n#clf2 = pipe.fit(X2, y2)\novo_rf_umap = pipe.fit(full_x, full_y)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544350714_-579828367","id":"20200625-122526_596142429","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:148"},{"text":"%pyspark\nx = X2.isna().sum()\n\nwith pd.option_context('display.max_rows', None, 'display.max_columns', None):  # more options can be specified also\n    print(X2.dtypes)\n    \n\n#RandomForestClassifier(random_state=0, n_jobs=-1, class_weight=\"balanced\")\n# from sklearn.svm import SVC\n# SVC(gamma='auto', kernel='rbf',probability=True)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544350802_-186581816","id":"20200624-114241_1106301057","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:149"},{"title":"OneVSone rf var imp","text":"%pyspark\nimport pandas as pd\nmodel_obj = ovo_rf_umap['model']\n\nfeat_imp = pd.DataFrame([])\n\nonehot_columns = ovo_rf_umap.named_steps['preprocess'].named_transformers_['cat'].named_steps['onehot'].get_feature_names(input_features=sel)\n\nfor k, i in enumerate(model_obj.estimators_):\n    \n    fi = i.feature_importances_\n    \n    tmp_fi = pd.DataFrame({  'model_idx': k, \"var_imp\" : np.array( list(set(sel) ^ set(list(X2))) + list(onehot_columns)),  'raw_val': fi} )\n    \n    tmp_fi = tmp_fi.sort_values(by=['raw_val'], ascending = False)\n    \n    tmp_fi = tmp_fi.reset_index(inplace=False, drop=False)\n    tmp_fi['rank_local'] = tmp_fi.index + 1\n    \n    feat_imp = feat_imp.append(tmp_fi)\n\n\n\n#with pd.option_context('display.max_rows', None, 'display.max_columns', None):  # more options can be specified also\n#    print(feat_imp)\nimp_spk = spark.createDataFrame(feat_imp)   \n\n\nimp_spk.repartition(1).write.format(\"csv\").mode(\"overwrite\").option(\"header\", \"true\").save(\"/user/nathaniel_net/research/age_model/postpaid_model_group1234/final_varImp.csv\")","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:30+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 8: for k, i in enumerate(model_obj.estimators_):\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-5980207797386606270.py\", line 375, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 8, in <module>\nAttributeError: 'LGBMClassifier' object has no attribute 'estimators_'\n"}]},"apps":[],"jobName":"paragraph_1599544350913_-1270325919","id":"20200625-100935_1998615500","dateCreated":"2020-09-08T12:52:30+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:150"},{"text":"%pyspark\nimport lightgbm as lgb\n\nmodel_obj = ovo_rf_umap['model']\nonehot_columns = ovo_rf_umap.named_steps['preprocess'].named_transformers_['cat'].named_steps['onehot'].get_feature_names(input_features=sel)\ntmp_fi = pd.DataFrame({  'model_idx': 0, \"var_imp\" : np.array( list(set(sel) ^ set(list(X2))) + list(onehot_columns)),  'split': model_obj.booster_.feature_importance(importance_type='split'), 'gain': model_obj.booster_.feature_importance(importance_type='gain')} )\n\ntmp_fi = spark.createDataFrame(tmp_fi)   \ntmp_fi.repartition(1).write.format(\"csv\").mode(\"overwrite\").option(\"header\", \"true\").save(\"/user/nathaniel_net/research/age_model/postpaid_model_group1234/final_varImp.csv\")","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:31+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544351015_703398480","id":"20200710-093101_572537906","dateCreated":"2020-09-08T12:52:31+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:151"},{"text":"%pyspark\nrf1 = ovo_rf_umap['model'].estimators_[5]\n\n[estimator.tree_.max_depth for estimator in rf1.estimators_]","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:31+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[53, 53, 48, 45, 61, 45, 69, 53, 48, 43, 60, 45, 46, 45, 45, 48, 54, 47, 41, 62, 43, 56, 43, 53, 42, 45, 46, 58, 52, 56, 47, 47, 62, 47, 52, 59, 44, 40, 42, 50, 40, 55, 58, 51, 51, 56, 43, 47, 48, 59, 56, 43, 59, 40, 48, 45, 51, 48, 54, 45, 56, 45, 50, 49, 64, 39, 44, 54, 49, 46, 57, 48, 43, 59, 45, 40, 43, 50, 57, 43, 49, 48, 49, 52, 53, 51, 46, 43, 45, 44, 51, 44, 53, 46, 55, 40, 48, 49, 44, 47]\n"}]},"apps":[],"jobName":"paragraph_1599544351115_1083269193","id":"20200625-101615_1449529591","dateCreated":"2020-09-08T12:52:31+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:152"},{"text":"%pyspark\n\nclf2 = ovo_rf_umap\n\n\nfrom sklearn.metrics import classification_report, confusion_matrix\nconfusion_matrix(y2, clf2.predict(X2))\nprint(classification_report(y2, clf2.predict(X2)))\n\n\nfrom sklearn.metrics import classification_report, confusion_matrix\nconfusion_matrix(ty2, clf2.predict(tX2))\n\nprint(classification_report(ty2, clf2.predict(tX2)))\n\n\n\n#ot2 = clf2.predict(data_unknown_pd)\n#import collections, numpy\n#collections.Counter(ot2)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:31+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"              precision    recall  f1-score   support\n\n           1       0.51      0.42      0.46    126234\n           2       0.50      0.46      0.48    279022\n           3       0.41      0.44      0.43    357552\n           4       0.53      0.56      0.54    334810\n\n    accuracy                           0.48   1097618\n   macro avg       0.49      0.47      0.48   1097618\nweighted avg       0.48      0.48      0.48   1097618\n\n              precision    recall  f1-score   support\n\n           1       0.50      0.42      0.46     53750\n           2       0.50      0.46      0.48    119473\n           3       0.41      0.43      0.42    152437\n           4       0.52      0.56      0.54    143184\n\n    accuracy                           0.48    468844\n   macro avg       0.48      0.47      0.47    468844\nweighted avg       0.48      0.48      0.48    468844\n\n"}]},"apps":[],"jobName":"paragraph_1599544351224_-1197995788","id":"20200624-111416_679970155","dateCreated":"2020-09-08T12:52:31+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:153"},{"text":"%pyspark\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:31+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1\n"}]},"apps":[],"jobName":"paragraph_1599544351618_-328204336","id":"20200630-121024_654918595","dateCreated":"2020-09-08T12:52:31+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:154"},{"text":"%pyspark\nimport pandas as pd\n\nclf2 = ovo_rf_umap\n\not2 = clf2.predict(data_unknown_pd)\n#import collections, numpy\n#collections.Counter(ot2)\n\npred = pd.DataFrame(\n    {'ovo_pred_other': ot2.tolist(),\n     'msisdn': data_unknown_pd['msisdn'].tolist()})\n\npred_ovo = spark.createDataFrame(pred)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:31+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"/home/zeppelin/.local/lib/python3.6/site-packages/sklearn/compose/_column_transformer.py:440: FutureWarning: Given feature/column names or counts do not match the ones for the data given during fit. This will fail from v0.24.\n  FutureWarning)\n"}]},"apps":[],"jobName":"paragraph_1599544351715_1738456221","id":"20200624-111506_1100273111","dateCreated":"2020-09-08T12:52:31+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:155"},{"text":"%pyspark\n\n\"\"\"\n\n\"\"\"\npred_ovo_agg = pred_ovo.withColumnRenamed(\"ovo_pred_other\",\"age\").groupBy(\"age\").agg(count(\"age\").alias(\"pred_other\"))\npred_ovo_agg = pred_ovo_agg.join(age_data.filter(col(\"age\").isNotNull() ).groupBy(\"age\").agg(count(lit(1)).alias(\"fact\")), ['age'], \"right\")\n\nsum_pred_other = pred_ovo_agg.agg(sum(\"pred_other\").alias(\"pred_other_sum\")).collect()[0][0]\nsum_fact = pred_ovo_agg.agg(sum(\"fact\").alias(\"fact_sum\")).collect()[0][0]\n\npred_ovo_agg = pred_ovo_agg.withColumn(\"pred_other_prop\",( (col(\"pred_other\") * 100) / sum_pred_other) )\npred_ovo_agg = pred_ovo_agg.withColumn(\"fact_prop\",((col(\"fact\") * 100) / sum_fact ) )\n       \nz.show(pred_ovo_agg)\n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:31+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"age":"string","pred_other":"string","fact":"string","pred_other_prop":"string","fact_prop":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"age","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"pred_other_prop","index":3,"aggr":"sum"},{"name":"fact_prop","index":4,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"age\tpred_other\tfact\tpred_other_prop\tfact_prop\n1\t47328\t90074\t5.967996166601516\t10.903469781044517\n3\t186925\t255006\t23.57098722620834\t30.868510502309636\n2\t72201\t199627\t9.104447498833588\t24.16487512468164\n4\t486576\t281397\t61.35656910835656\t34.06314459196421\n"},{"type":"TEXT","data":"\n"}]},"apps":[],"jobName":"paragraph_1599544351835_-1098752702","id":"20200629-181415_1520334008","dateCreated":"2020-09-08T12:52:31+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:156"},{"text":"%pyspark\n\ndata_unknown = data_unknown.na.fill(0)\n#data_unknown = data_unknown.drop(\"age\")\n#final_model = pipeline.fit(data_unknown)\n\npredictions_unknown = model_postpaid.transform(data_unknown)\n\npredictions_unknown_agg = predictions_unknown.groupBy(\"prediction\").agg(count(\"prediction\").alias(\"predicted_unknown\"))\npredictions_unknown_agg = predictions_unknown_agg.withColumn(\"age\", predictions_unknown_agg[\"prediction\"].cast(IntegerType())  )\npredictions_unknown_agg = predictions_unknown_agg.select(\"age\", \"predicted_unknown\")\n\n# replace\nfrom pyspark.ml.feature import StringIndexer, StringIndexerModel\nlabel_map = {x._java_obj.getOutputCol(): x.labels for x in model_postpaid.stages if isinstance(x, StringIndexerModel)}[\"label\"]\nlabel_map = {int(k) : int(v) for k,v in enumerate(label_map)}\n\nlabel_map_df = spark.createDataFrame(list(map(list, label_map.items())), [\"age\", \"age_decode\"])\npredictions_unknown_agg = predictions_unknown_agg.join(label_map_df, [\"age\"], \"inner\")\npredictions_unknown_agg = predictions_unknown_agg.withColumn(\"age\", col(\"age_decode\")).drop(\"age_decode\")\n\ndata_fact_agg = data_fact.select(\"age\").groupBy(\"age\").agg(count(\"age\").alias(\"fact\"))\nresult = data_fact_agg.join(predictions_unknown_agg, [\"age\"], \"left\")\n\n\npred_ovo_set = pred_ovo#data_unknown.select(\"msisdn\").join(pred_ovo, ['msisdn'], \"left\")\npred_ovo_set = pred_ovo_set.groupBy(\"ovo_pred_other\").agg(count(\"ovo_pred_other\").alias(\"ovo_pred_unknown_other\")).withColumnRenamed(\"ovo_pred_other\", \"age\")\nresult = result.join(pred_ovo_set, [\"age\"], \"left\")\n\n\nresult.show()\n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:31+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 5: predictions_unknown = model_postpaid.transform(data_unknown)\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-8910792004996240307.py\", line 375, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 5, in <module>\nNameError: name 'model_postpaid' is not defined\n"}]},"apps":[],"jobName":"paragraph_1599544351920_1336595144","id":"20200624-132731_634007194","dateCreated":"2020-09-08T12:52:31+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:157"},{"text":"%pyspark\n\nimport joblib\njoblib.dump(ovo_rf_umap, 'postpaid_model_class1234_lgbm_final.pkl', compress = 3) # 0 to 9 compress level","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:32+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"['postpaid_model_class1234_lgbm_final.pkl']\n"}]},"apps":[],"jobName":"paragraph_1599544352004_-1164322197","id":"20200624-232003_1530585738","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:158"},{"text":"%sh\nkinit -kt /etc/security/keytabs/nathaniel_net.keytab\nhdfs dfs -put ./postpaid_model_class1234_lgbm_final.pkl \"/user/nathaniel_net/research/age_model/postpaid_model_group1234/postpaid_model_class1234_lgbm_final\" \n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:32+0700","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"kinit: Keytab contains no suitable keys for host/mtg8-ar-01.tap.true.th@TAP.TRUE.TH while getting initial credentials\n"}]},"apps":[],"jobName":"paragraph_1599544352093_-1494809295","id":"20200627-131223_2140542183","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:159"},{"text":"%sh\ndu -msh postpaid_model_class1234_lgbm_final.pkl","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:32+0700","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"820K\tpostpaid_model_class1234_lgbm_final.pkl\n"}]},"apps":[],"jobName":"paragraph_1599544352181_173308074","id":"20200627-132026_1306021716","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:160"},{"text":"%pyspark\nimport joblib\ntrained_model = joblib.load('./postpaid_model_class1234_lgbm_final.pkl')","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:32+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544352287_-1771084262","id":"20200624-233125_2071383306","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:161"},{"text":"%pyspark\nmodel = joblib.load('./postpaid_model_class1234_ovo_lgbm_70percent.pkl')\nmodel_bc = spark.sparkContext.broadcast(model)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:32+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544352686_144032260","id":"20200627-172816_1603081274","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:162"},{"text":"%pyspark\noutput = testData.limit(10)\noutput.cache().count()\n# ","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:32+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"10\n"}]},"apps":[],"jobName":"paragraph_1599544352789_1762875460","id":"20200627-235059_956139287","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:163"},{"text":"%pyspark\nmodel_bc = spark.sparkContext.broadcast(ovo_rf_umap)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:32+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544352899_-1631750317","id":"20200630-131927_503111069","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:164"},{"text":"%pyspark\n\nfrom pyspark.sql.functions import udf, struct, pandas_udf, PandasUDFType, spark_partition_id\nimport joblib\nspark.sparkContext._jsc.hadoopConfiguration().set(\"mapred.max.split.size\", \"33554432\")\nselect_col = col_sel_imp\n\n#test_model_serialize = ovo_rf_umap\n@udf(returnType=StringType())\ndef predict_udf_sk(*cols):\n    # input a tuple type with float value.\n    \n    import pandas as pd\n    \n    df = pd.DataFrame([cols], columns = ['ARPA_6_MTHS', 'CUR_INV_AMT', 'INTERNET_AMT_AVG', 'POST_TMVH_AMT_AVG', 'TMH_DOWNLOAD_GB', 'TMH_UPLOAD_GB', 'TMH_VOICE_INCOMING_DUR_MINS', 'TMH_VOICE_OUTGOING_DUR_MINS', 'callDurationEntropy_mean', 'cellsite_cnt_distinct_day_mean', 'cellsite_popularity_index_nrm_mean', 'cellsite_popularity_month_mean', 'condo_resident_category_prob', 'condo_resident_number_of_distinct_days_in_poi_cat', 'condo_resident_number_of_hours_in_poi_cat', 'data_usage', 'domain_cnt_mean', 'government_worker_category_prob', 'government_worker_number_of_distinct_days_in_poi_cat', 'government_worker_number_of_hours_in_poi_cat', 'handset_brand', 'nightclubber_category_prob', 'nightclubber_number_of_distinct_days_in_poi_cat', 'nightclubber_number_of_hours_in_poi_cat', 'school_student_category_prob', 'school_student_number_of_distinct_days_in_poi_cat', 'school_student_number_of_hours_in_poi_cat', 'truemoney_user_flg', 'trueyou_point_remain', 'university_student_category_prob', 'university_student_number_of_distinct_days_in_poi_cat', 'university_student_number_of_hours_in_poi_cat', 'voiceInDegree', 'voiceOutDegree', 'voice_out_2grp', 'vvDegreeRatio', 'msisdn', 'flag', 'subs_type', 'age'] ) \n    \n    df_in = df[['ARPA_6_MTHS', 'CUR_INV_AMT', 'INTERNET_AMT_AVG', 'POST_TMVH_AMT_AVG', 'TMH_DOWNLOAD_GB', 'TMH_UPLOAD_GB', 'TMH_VOICE_INCOMING_DUR_MINS', 'TMH_VOICE_OUTGOING_DUR_MINS', 'callDurationEntropy_mean', 'cellsite_cnt_distinct_day_mean', 'cellsite_popularity_index_nrm_mean', 'cellsite_popularity_month_mean', 'condo_resident_category_prob', 'condo_resident_number_of_distinct_days_in_poi_cat', 'condo_resident_number_of_hours_in_poi_cat', 'data_usage', 'domain_cnt_mean', 'government_worker_category_prob', 'government_worker_number_of_distinct_days_in_poi_cat', 'government_worker_number_of_hours_in_poi_cat', 'handset_brand', 'nightclubber_category_prob', 'nightclubber_number_of_distinct_days_in_poi_cat', 'nightclubber_number_of_hours_in_poi_cat', 'school_student_category_prob', 'school_student_number_of_distinct_days_in_poi_cat', 'school_student_number_of_hours_in_poi_cat', 'truemoney_user_flg', 'trueyou_point_remain', 'university_student_category_prob', 'university_student_number_of_distinct_days_in_poi_cat', 'university_student_number_of_hours_in_poi_cat', 'voiceInDegree', 'voiceOutDegree', 'voice_out_2grp', 'vvDegreeRatio']]\n    result  = model_bc.value.predict(df_in)\n    \n    #result = model_bc.value.predict(df)\n    # sklearn predict() return array type  so we need to change regarding udf output type\n    \n    return str(list(result))\n\n\nspark.conf.set(\"spark.sql.execution.arrow.pyspark.enabled\", \"true\")\n\n# define the Pandas UDF  # having a problem with parrow >= 0.15.0\n@pandas_udf(StringType(), PandasUDFType.SCALAR)\ndef apply_model2(*sample_df):\n    \n    \n    import pandas as pd\n    \n    sample_df = pd.concat(sample_df, axis =1)\n    \n    # run the model on the partitioned data set \n    #ids = sample_df['msisdn']\n   # x_train = sample_df.drop(['age', 'msisdn', 'subs_type', 'flag'], axis=1)\n   # pred = str(list(model_bc.value.predict(x_train))[0])\n    pred = pd.Series( (model_bc.value.predict(sample_df)).tolist(), name = \"prediction\", dtype='str' )\n\n    return pred#pd.DataFrame({'msisdn': ids, 'prediction': pred })\n    \n# define a schema for the result set, the user ID and model prediction\nschema = StructType([StructField('msisdn', StringType(), True),\n                     StructField('prediction', StringType(), True)])  \n\n# define the Pandas UDF  # having a problem with parrow >= 0.15.0\n@pandas_udf(\"msisdn string, prediction string\", PandasUDFType.GROUPED_MAP)\ndef apply_model(sample_df):\n    \n    import pandas as pd\n    import lightgbm\n    \n    # run the model on the partitioned data set \n    ids = sample_df['msisdn']\n    x_train = sample_df.drop(['age', 'msisdn', 'subs_type', 'flag'], axis=1)\n   # pred = str(list(model_bc.value.predict(x_train))[0])\n    pred = pd.Series( (model_bc.value.predict(x_train)).tolist(), name = \"prediction\", dtype='str' )\n\n    return pd.DataFrame({'msisdn': ids, 'prediction': pred })\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:33+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544352994_-1819387354","id":"20200627-125824_926707629","dateCreated":"2020-09-08T12:52:32+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:165"},{"text":"%pyspark\n\n#output_final = output.repartition(80).withColumn(\"prediction\", predict_udf_sk( *select_col ) )   # udf paralell depednson partition size (worker) if 1 then not good distribution\n\n#output_final = data_unknown_fillter.repartition(80).select(\"msisdn\", (apply_model2( *select_col )).alias(\"pred\") )   # udf paralell depednson partition size (worker) if 1 then not good distribution\n\n#### ***** if use .show() or z.show() it will not parallel\n# \"pid\", spark_partition_id()\n#output_final = data_unknown_fillter.groupby(\"msisdn\").apply(apply_model)    # having a problem with parrow >= 0.15.0\n\n#col_namexx = ['ARPA_6_MTHS', 'CUR_INV_AMT', 'INTERNET_AMT_AVG', 'POST_TMVH_AMT_AVG', 'TMH_DOWNLOAD_GB', 'TMH_UPLOAD_GB', 'TMH_VOICE_INCOMING_DUR_MINS', 'TMH_VOICE_OUTGOING_DUR_MINS', 'callDurationEntropy_mean', 'cellsite_cnt_distinct_day_mean', 'cellsite_popularity_index_nrm_mean', 'cellsite_popularity_month_mean', 'condo_resident_category_prob', 'condo_resident_number_of_distinct_days_in_poi_cat', 'condo_resident_number_of_hours_in_poi_cat', 'data_usage', 'domain_cnt_mean', 'government_worker_category_prob', 'government_worker_number_of_distinct_days_in_poi_cat', 'government_worker_number_of_hours_in_poi_cat', 'handset_brand', 'nightclubber_category_prob', 'nightclubber_number_of_distinct_days_in_poi_cat', 'nightclubber_number_of_hours_in_poi_cat', 'school_student_category_prob', 'school_student_number_of_distinct_days_in_poi_cat', 'school_student_number_of_hours_in_poi_cat', 'truemoney_user_flg', 'trueyou_point_remain', 'university_student_category_prob', 'university_student_number_of_distinct_days_in_poi_cat', 'university_student_number_of_hours_in_poi_cat', 'voiceInDegree', 'voiceOutDegree', 'voice_out_2grp', 'vvDegreeRatio']\n#output_final = output.select(\"msisdn\", apply_model2(*col_namexx))   # having a problem with parrow >= 0.15.0\n\noutput = data_unknown_fillter#.limit(100)\noutput = output.repartition(1000)\noutput_final = output.withColumn(\"pid\", spark_partition_id() ).groupby(\"pid\").apply(apply_model)    # having a problem with parrow >= 0.15.0\n#output_final.select(\"msisdn\", \"prediction\").write.mode(\"overwrite\").format(\"orc\").save( \"/user/nathaniel_net/research/age_model/_tmpfile/postpaid_model_class1234_ovo_lgbm_70percent_4\")\n\noutput_final.select(\"msisdn\", \"prediction\").write.mode(\"overwrite\").format(\"orc\").save( \"/user/nathaniel_net/research/age_model/postpaid_model_group1234/unknown_prediction_final\")\n\n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:33+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"age":"string","predict_udf(ARPA_6_MTHS, CUR_INV_AMT, INTERNET_AMT_AVG, POST_TMVH_AMT_AVG, TMH_DOWNLOAD_GB, TMH_UPLOAD_GB, TMH_VOICE_INCOMING_DUR_MINS, TMH_VOICE_OUTGOING_DUR_MINS, callDurationEntropy_mean, cellsite_cnt_distinct_day_mean, cellsite_popularity_index_nrm_mean, cellsite_popularity_month_mean, condo_resident_category_prob, condo_resident_number_of_distinct_days_in_poi_cat, condo_resident_number_of_hours_in_poi_cat, data_usage, domain_cnt_mean, government_worker_category_prob, government_worker_number_of_distinct_days_in_poi_cat, government_worker_number_of_hours_in_poi_cat, handset_brand, nightclubber_category_prob, nightclubber_number_of_distinct_days_in_poi_cat, nightclubber_number_of_hours_in_poi_cat, school_student_category_prob, school_student_number_of_distinct_days_in_poi_cat, school_student_number_of_hours_in_poi_cat, truemoney_user_flg, trueyou_point_remain, university_student_category_prob, university_student_number_of_distinct_days_in_poi_cat, university_student_number_of_hours_in_poi_cat, voiceInDegree, voiceOutDegree, voice_out_2grp, vvDegreeRatio, msisdn, flag, subs_type, age)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544353087_1776136558","id":"20200627-160202_1195776878","dateCreated":"2020-09-08T12:52:33+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:166"},{"text":"%pyspark\n\nspark.read.orc( \"/user/nathaniel_net/research/age_model/postpaid_model_group1234/unknown_prediction_final\").groupBy(\"prediction\").count().show()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:33+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+------+\n|prediction| count|\n+----------+------+\n|         3|260975|\n|         1| 17422|\n|         4|316581|\n|         2| 21818|\n+----------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544353206_500881339","id":"20200707-212502_1099084014","dateCreated":"2020-09-08T12:52:33+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:167"},{"text":"%pyspark\n\nspark.read.orc(\"/user/nathaniel_net/research/age_model/_tmpfile/postpaid_model_class1234_ovo_lgbm_70percent_2\").groupBy(\"prediction\").count().show()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:33+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+------+\n|prediction| count|\n+----------+------+\n|         3|165267|\n|         1| 45793|\n|         4|513989|\n|         2| 67981|\n+----------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544353295_-173865698","id":"20200708-000724_2135194133","dateCreated":"2020-09-08T12:52:33+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:168"},{"text":"%pyspark\n# sample 4 90% /// feature 73\nspark.read.orc( \"/user/nathaniel_net/research/age_model/_tmpfile/postpaid_model_class1234_ovo_lgbm_70percent_4\").groupBy(\"prediction\").count().show()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:33+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+------+\n|prediction| count|\n+----------+------+\n|         3|182003|\n|         1| 15552|\n|         4|394218|\n|         2| 25023|\n+----------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544353695_511971005","id":"20200708-003347_2056021830","dateCreated":"2020-09-08T12:52:33+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:169"},{"text":"%pyspark\n\nspark.read.orc( \"/user/nathaniel_net/research/age_model/_tmpfile/postpaid_model_class1234_ovo_lgbm_70percent_4\").groupBy(\"prediction\").count().show()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:33+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+------+\n|prediction| count|\n+----------+------+\n|         3|260975|\n|         1| 17422|\n|         4|316581|\n|         2| 21818|\n+----------+------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544353786_1350012528","id":"20200709-222622_1002908630","dateCreated":"2020-09-08T12:52:33+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:170"},{"text":"%pyspark\ndata_fact = data.filter( col(\"age\").isNotNull() ).select(\"msisdn\", \"age\").withColumn(\"status\", lit(\"fact\"))\n\ndata_pred = spark.read.orc( \"/user/nathaniel_net/research/age_model/postpaid_model_group1234/unknown_prediction_final\").select(\"prediction\", \"msisdn\").withColumnRenamed(\"prediction\", \"age\").withColumn(\"status\", lit(\"predicted\"))\n\nres = data_fact.unionByName(data_pred)\nres.repartition(80).write.mode(\"overwrite\").format(\"orc\").save( \"/user/nathaniel_net/research/age_model/postpaid_model_group1234/unknown_prediction_final_to_send\")\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:33+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1599544353886_1498312017","id":"20200713-143732_286049657","dateCreated":"2020-09-08T12:52:33+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:171"},{"text":"%pyspark\nspark.read.orc( \"/user/nathaniel_net/research/age_model/postpaid_model_group1234/unknown_prediction_final_to_send\").groupby(\"age\", \"status\").count().show()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+---------+-------+\n|age|   status|  count|\n+---+---------+-------+\n|  2|predicted|  21818|\n|  4|predicted| 316581|\n|  3|predicted| 260975|\n|  1|predicted|  17422|\n|  2|     fact|1094178|\n|  3|     fact| 940165|\n|  4|     fact| 843057|\n|  1|     fact| 802293|\n+---+---------+-------+\n\n"}]},"apps":[],"jobName":"paragraph_1599544353981_162970728","id":"20200713-144545_1481121802","dateCreated":"2020-09-08T12:52:33+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:172"},{"text":"%pyspark\n\ndata_unknown_fillter.cache().count()\n\npred_ovo = data_unknown_fillter.groupby(\"msisdn\").apply(apply_model) \n\npred_ovo_agg = pred_ovo.withColumnRenamed(\"prediction\",\"age\").groupBy(\"age\").agg(count(\"age\").alias(\"pred_other\"))\npred_ovo_agg = pred_ovo_agg.join(age_data.filter(col(\"age\").isNotNull() ).groupBy(\"age\").agg(count(lit(1)).alias(\"fact\")), ['age'], \"right\")\n\n#sum_pred_other = pred_ovo_agg.agg(sum(\"pred_other\").alias(\"pred_other_sum\"))\n#sum_fact = pred_ovo_agg.agg(sum(\"fact\").alias(\"fact_sum\"))\n\n#pred_ovo_agg = pred_ovo_agg.withColumn(\"pred_other_prop\",( (col(\"pred_other\") * 100) / sum_pred_other) )\n#pred_ovo_agg = pred_ovo_agg.withColumn(\"fact_prop\",((col(\"fact\") * 100) / sum_fact ) )\n       \npred_ovo_agg.show()\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 14: pred_ovo_agg.show()\nTraceback (most recent call last):\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/sql/utils.py\", line 63, in deco\n    return f(*a, **kw)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/protocol.py\", line 320, in get_return_value\n    format(target_id, \".\", name), value)\npy4j.protocol.Py4JJavaError: An error occurred while calling o729.showString.\n: org.apache.spark.SparkException: Job 6 cancelled part of cancelled job group zeppelin-2FASN1MJZ-20200630-132144_1052230244\n\tat org.apache.spark.scheduler.DAGScheduler.org$apache$spark$scheduler$DAGScheduler$$failJobAndIndependentStages(DAGScheduler.scala:1599)\n\tat org.apache.spark.scheduler.DAGScheduler.handleJobCancellation(DAGScheduler.scala:1539)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleJobGroupCancelled$1.apply$mcVI$sp(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleJobGroupCancelled$1.apply(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGScheduler$$anonfun$handleJobGroupCancelled$1.apply(DAGScheduler.scala:811)\n\tat scala.collection.mutable.HashSet.foreach(HashSet.scala:78)\n\tat org.apache.spark.scheduler.DAGScheduler.handleJobGroupCancelled(DAGScheduler.scala:811)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:1789)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1769)\n\tat org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:1758)\n\tat org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:48)\n\tat org.apache.spark.scheduler.DAGScheduler.runJob(DAGScheduler.scala:642)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:2034)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:2055)\n\tat org.apache.spark.SparkContext.runJob(SparkContext.scala:2074)\n\tat org.apache.spark.sql.execution.SparkPlan.executeTake(SparkPlan.scala:363)\n\tat org.apache.spark.sql.execution.CollectLimitExec.executeCollect(limit.scala:38)\n\tat org.apache.spark.sql.Dataset.org$apache$spark$sql$Dataset$$collectFromPlan(Dataset.scala:3272)\n\tat org.apache.spark.sql.Dataset$$anonfun$head$1.apply(Dataset.scala:2484)\n\tat org.apache.spark.sql.Dataset$$anonfun$head$1.apply(Dataset.scala:2484)\n\tat org.apache.spark.sql.Dataset$$anonfun$52.apply(Dataset.scala:3253)\n\tat org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:77)\n\tat org.apache.spark.sql.Dataset.withAction(Dataset.scala:3252)\n\tat org.apache.spark.sql.Dataset.head(Dataset.scala:2484)\n\tat org.apache.spark.sql.Dataset.take(Dataset.scala:2698)\n\tat org.apache.spark.sql.Dataset.showString(Dataset.scala:254)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\n\tat py4j.Gateway.invoke(Gateway.java:282)\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\n\tat py4j.GatewayConnection.run(GatewayConnection.java:214)\n\tat java.lang.Thread.run(Thread.java:748)\n\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-9211938926754625946.py\", line 380, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 14, in <module>\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/sql/dataframe.py\", line 350, in show\n    print(self._jdf.showString(n, 20, vertical))\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 1160, in __call__\n    answer, self.gateway_client, self.target_id, self.name)\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/sql/utils.py\", line 65, in deco\n    s = e.java_exception.toString()\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 1158, in __call__\n    answer = self.gateway_client.send_command(command)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 908, in send_command\n    response = connection.send_command(command)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 1055, in send_command\n    answer = smart_decode(self.stream.readline()[:-1])\n  File \"/usr/local/lib/python3.6/socket.py\", line 586, in readinto\n    return self._sock.recv_into(b)\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/context.py\", line 243, in signal_handler\n    raise KeyboardInterrupt()\nKeyboardInterrupt\n"}]},"apps":[],"jobName":"paragraph_1599544354082_-1776129394","id":"20200630-132144_1052230244","dateCreated":"2020-09-08T12:52:34+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:173"},{"text":"%pyspark\n\n\nimport numpy as np\nfrom sklearn import datasets\n\ntrain_pd_new = train_pd.drop(['msisdn', 'flag', 'subs_type'], axis=1, inplace = False)\ntest_pd_new = test_pd.drop(['msisdn', 'flag', 'subs_type'], axis=1, inplace = False)\n\n#sel =  ['product_mix_grp2', 'truecard_type_2grp', 'truemoney_user_flg', 'trueid_user_flg', 'voice_out_2grp', 'ARPA_3GRP', 'ARPA_GROUP', 'device_type_5grp', 'handset_brand_3grp', 'handset_brand', 'TMH_DATA_USAGE_GB_2_GRP', 'TMH_DATA_USAGE_GB_GR']\n\nsel =  ['truemoney_user_flg', 'handset_brand', 'voice_out_2grp']\n\n\n\nfor i in sel:\n    train_pd_new[i] = train_pd_new[i].astype('str') \n    test_pd_new[i] = test_pd_new[i].astype('str') \n\nX2 = train_pd_new.drop(['age'], axis=1, inplace = False)\ny2 = train_pd_new['age']\n\ntX2 = test_pd_new.drop(['age'], axis=1, inplace = False)\nty2 = test_pd_new['age']\n\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.datasets import make_classification\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.multiclass import OneVsOneClassifier\nfrom sklearn.preprocessing import OneHotEncoder, LabelEncoder\nfrom sklearn.impute import SimpleImputer\nfrom sklearn.compose import ColumnTransformer\n#from sklearn_pandas import DataFrameMapper\nfrom sklearn.pipeline import Pipeline\nfrom sklearn.preprocessing import StandardScaler, OneHotEncoder\nfrom sklearn.decomposition import IncrementalPCA\n\n#from umap import UMAP\nfrom lightgbm import LGBMClassifier\n\n\nnumeric_transformer = Pipeline(steps=[\n    ('imputer', SimpleImputer(strategy='median')),\n    ('scaler', StandardScaler())])\n\n\ncategorical_transformer = Pipeline(steps=[('imputer', SimpleImputer(strategy='constant', fill_value='missing')),  ('onehot', OneHotEncoder(handle_unknown='ignore'))])\n    \npreprocessor = ColumnTransformer( transformers=[ (\"num\", numeric_transformer, list(set(sel) ^ set(list(X2))) ) ,  ('cat',categorical_transformer  , sel)  ])\n\n#pipe = Pipeline([  (\"preprocess\", preprocessor) , ('model',  OneVsOneClassifier(LogisticRegression()) ) ])\n#umap = UMAP(random_state=456, n_components = 50, n_neighbors= 9)\n\ndim_reduc = IncrementalPCA(\n    copy=False,\n    n_components=10,\n    batch_size=(1000)\n)\n\npipe = Pipeline([  (\"preprocess\", preprocessor) , (\"dim_reduc\", dim_reduc) ,('model',  OneVsOneClassifier(RandomForestClassifier(max_depth = 50, criterion='entropy', random_state=0, n_jobs=-1, class_weight=\"balanced\") ) ) ])\n\n#clf2 = pipe.fit(X2, y2)\novo_rf_umap2 = pipe.fit(X2, y2)\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544354178_-510435079","id":"20200624-233238_1577046118","dateCreated":"2020-09-08T12:52:34+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:174"},{"text":"%pyspark\n\ntestData.rdd.getNumPartitions()","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"200\n"}]},"apps":[],"jobName":"paragraph_1599544354270_-389036579","id":"20200624-233814_619574641","dateCreated":"2020-09-08T12:52:34+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:175"},{"text":"%pyspark\n\nimport pandas as pd\nfrom pyspark.sql import Row\n\n\nrdd_col = ['ARPA_6_MTHS', 'CUR_INV_AMT', 'INTERNET_AMT_AVG', 'POST_TMVH_AMT_AVG', 'TMH_DOWNLOAD_GB', 'TMH_UPLOAD_GB', 'TMH_VOICE_INCOMING_DUR_MINS', 'TMH_VOICE_OUTGOING_DUR_MINS', 'callDurationEntropy_mean', 'cellsite_cnt_distinct_day_mean', 'cellsite_popularity_index_nrm_mean', 'cellsite_popularity_month_mean', 'condo_resident_category_prob', 'condo_resident_number_of_distinct_days_in_poi_cat', 'condo_resident_number_of_hours_in_poi_cat', 'data_usage', 'domain_cnt_mean', 'government_worker_category_prob', 'government_worker_number_of_distinct_days_in_poi_cat', 'government_worker_number_of_hours_in_poi_cat', 'handset_brand', 'nightclubber_category_prob', 'nightclubber_number_of_distinct_days_in_poi_cat', 'nightclubber_number_of_hours_in_poi_cat', 'school_student_category_prob', 'school_student_number_of_distinct_days_in_poi_cat', 'school_student_number_of_hours_in_poi_cat', 'truemoney_user_flg', 'trueyou_point_remain', 'university_student_category_prob', 'university_student_number_of_distinct_days_in_poi_cat', 'university_student_number_of_hours_in_poi_cat', 'voiceInDegree', 'voiceOutDegree', 'voice_out_2grp', 'vvDegreeRatio', 'msisdn', 'flag', 'subs_type', 'age']\n\ndef pred_pd(tupl):\n    df = pd.DataFrame([tupl],  columns = rdd_col )\n    df = df[ list(set(rdd_col) ^ set([ 'msisdn', 'flag', 'subs_type', 'age'])) ]\n    return Row(msisdn=tupl.msisdn , prediction=str(list(model_bc.value.predict(df))[0]))\n\ndd = testData.rdd.map(pred_pd)\n#dd = output.rdd.mapPartitions(pred_pd)\n\n#dd.take(2)\n#z.show(dd.toDF())\n\ndd.toDF().write.mode(\"overwrite\").format(\"orc\").save( \"/user/nathaniel_net/research/age_model/_tmpfile/udf_test_skl\")","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"msisdn":"string","prediction":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 18: dd.toDF().write.mode(\"overwrite\").format(\"orc\").save( \"/user/nathaniel_net/research/age_model/_tmpfile/udf_test_skl\")\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-8029562189451892510.py\", line 380, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 18, in <module>\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/sql/readwriter.py\", line 705, in save\n    self._jwrite.save(path)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 1158, in __call__\n    answer = self.gateway_client.send_command(command)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 908, in send_command\n    response = connection.send_command(command)\n  File \"/usr/hdp/current/spark2-client/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py\", line 1055, in send_command\n    answer = smart_decode(self.stream.readline()[:-1])\n  File \"/usr/local/lib/python3.6/socket.py\", line 586, in readinto\n    return self._sock.recv_into(b)\n  File \"/usr/hdp/current/spark2-client/python/lib/pyspark.zip/pyspark/context.py\", line 243, in signal_handler\n    raise KeyboardInterrupt()\nKeyboardInterrupt\n"}]},"apps":[],"jobName":"paragraph_1599544354602_-52325590","id":"20200628-001535_1287985397","dateCreated":"2020-09-08T12:52:34+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:176"},{"text":"%pyspark\noutput.rdd.take(1)","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(ARPA_6_MTHS=0, CUR_INV_AMT=0, INTERNET_AMT_AVG=0, POST_TMVH_AMT_AVG=0, TMH_DOWNLOAD_GB=0, TMH_UPLOAD_GB=0, TMH_VOICE_INCOMING_DUR_MINS=0, TMH_VOICE_OUTGOING_DUR_MINS=0, callDurationEntropy_mean=-3.5760165638416748, cellsite_cnt_distinct_day_mean=6.678571428571429, cellsite_popularity_index_nrm_mean=26.152432890348, cellsite_popularity_month_mean=4890.504950495049, condo_resident_category_prob=0.10305343511450382, condo_resident_number_of_distinct_days_in_poi_cat=15, condo_resident_number_of_hours_in_poi_cat=54, data_usage=14641, domain_cnt_mean=16.892857142857142, government_worker_category_prob=0.025974025974025976, government_worker_number_of_distinct_days_in_poi_cat=3, government_worker_number_of_hours_in_poi_cat=4, handset_brand='Samsung', nightclubber_category_prob=0.14516129032258066, nightclubber_number_of_distinct_days_in_poi_cat=13, nightclubber_number_of_hours_in_poi_cat=36, school_student_category_prob=0.22727272727272727, school_student_number_of_distinct_days_in_poi_cat=18, school_student_number_of_hours_in_poi_cat=35, truemoney_user_flg='0', trueyou_point_remain=0, university_student_category_prob=0.0, university_student_number_of_distinct_days_in_poi_cat=0, university_student_number_of_hours_in_poi_cat=0, voiceInDegree=224, voiceOutDegree=1605, voice_out_2grp='>120mins', vvDegreeRatio=0.1395638629283489, msisdn='22638fcf5e540c804aad0d03f02e7491078740509df2b8349f22f842ab8a9616', flag=1, subs_type='POST', age=2)]\n"}]},"apps":[],"jobName":"paragraph_1599544354690_-96249611","id":"20200628-004522_704476976","dateCreated":"2020-09-08T12:52:34+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:177"},{"text":"%sh\n#\npip install pyarrow==0.14.1 --user --proxy http://192.168.250.9:8080/ \n\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/sh","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Collecting pyarrow==0.14.1\n  Downloading pyarrow-0.14.1-cp36-cp36m-manylinux2010_x86_64.whl (58.1 MB)\nRequirement already satisfied: six>=1.0.0 in ./.local/lib/python3.6/site-packages (from pyarrow==0.14.1) (1.12.0)\nRequirement already satisfied: numpy>=1.14 in ./.local/lib/python3.6/site-packages (from pyarrow==0.14.1) (1.19.0)\nInstalling collected packages: pyarrow\nSuccessfully installed pyarrow-0.14.1\nWARNING: You are using pip version 20.0.2; however, version 20.1.1 is available.\nYou should consider upgrading via the '/usr/local/bin/python3.6 -m pip install --upgrade pip' command.\n"}]},"apps":[],"jobName":"paragraph_1599544354791_-1836222267","id":"20200628-112317_1761886679","dateCreated":"2020-09-08T12:52:34+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:178"},{"text":"%pyspark\n[]]\n\ngeo_lab = spark.read.orc(\"/user/nathaniel_net/research/age_model/data_prep/geo_label_jan\")\ngeo_lab.columns \n\ngeo_label_part = [\"school_student\", \"university_student\", \"condo_resident\", \"nightclubber\", \"government_worker\"]\n[l1 for l1 in geo_lab.columns  if any([l2 in l1 for l2 in geo_label_part])]","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:34+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"['condo_resident_number_of_hours_in_poi_cat', 'condo_resident_number_of_distinct_days_in_poi_cat', 'condo_resident_max_number_of_distinct_days_in_category', 'condo_resident_category_prob', 'government_worker_number_of_hours_in_poi_cat', 'government_worker_number_of_distinct_days_in_poi_cat', 'government_worker_max_number_of_distinct_days_in_category', 'government_worker_category_prob', 'nightclubber_number_of_hours_in_poi_cat', 'nightclubber_number_of_distinct_days_in_poi_cat', 'nightclubber_max_number_of_distinct_days_in_category', 'nightclubber_category_prob', 'school_student_number_of_hours_in_poi_cat', 'school_student_number_of_distinct_days_in_poi_cat', 'school_student_max_number_of_distinct_days_in_category', 'school_student_category_prob', 'university_student_number_of_hours_in_poi_cat', 'university_student_number_of_distinct_days_in_poi_cat', 'university_student_max_number_of_distinct_days_in_category', 'university_student_category_prob']\n"}]},"apps":[],"jobName":"paragraph_1599544354900_-1422735833","id":"20200628-120254_231990327","dateCreated":"2020-09-08T12:52:34+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:179"},{"text":"%pyspark\ntrain_pd['msisdn']","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:35+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0          398430a0f4c5c61ebc18ab5e6bba189f475639f19c441e...\n1          93852758647d61de59b8e0003f2abc3a227ce86d0b5554...\n2          d2d468d06d7b3c18eaaeee508cc13be8bc2f2427a22d7b...\n3          febd7834fa45806f16f3d38686e37b475c18f4265b7ac8...\n4          b34d06e0a0b7dc3c06948b163621d2bd7390ffc6622467...\n                                 ...                        \n1586126    c67b88ebcefb2d265c242bcf17c863d5c96b5591baff72...\n1586127    9a8a45a13657113f62fc0c710af2dc130441560d95e0b7...\n1586128    81d5f416b9f90fb1f4a5dea829096c7ac23c936ae90fe0...\n1586129    e7d27d2052705ced22a84a55cbb80bf4190cf9dfeadec6...\n1586130    c9c71b3cf94f4cc4d34c840549cbce9fde2c3dc56dcb8f...\nName: msisdn, Length: 1586131, dtype: object\n"}]},"apps":[],"jobName":"paragraph_1599544355007_510460415","id":"20200629-170819_1526090738","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:180"},{"text":"%pyspark\npd.Series( ot2.tolist(), dtype='str' )","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:35+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"0          6\n1          7\n2          5\n3          1\n4          5\n          ..\n2984150    4\n2984151    4\n2984152    1\n2984153    6\n2984154    4\nLength: 2984155, dtype: object\n"}]},"apps":[],"jobName":"paragraph_1599544355117_1764888193","id":"20200629-233428_814866007","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:181"},{"text":"%pyspark\ndf = spark.read.orc('/trueanalytics/data/datasci/technical_delivery/trueyou/CLM/df') # 4,525,245\ntrain, test = (df.limit(2200000)).randomSplit([0.70, 0.30], seed=12345)\n# train.cache().count() # 1750806\ntrain_pd = train.toPandas()\nX = train_pd[features]\ny = train_pd[['label']]\ntest.cache().count() \ntest_pd = test.toPandas()\nX_test = test_pd[features]\ny_test = test_pd[['label']]","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:35+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 5: X = train_pd[features]\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-9211938926754625946.py\", line 375, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 5, in <module>\nNameError: name 'features' is not defined\n"}]},"apps":[],"jobName":"paragraph_1599544355216_439092481","id":"20200629-233503_844846957","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:182"},{"text":"%pyspark\n\n\nclass 10\nclass 90","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:35+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544355574_-1332378884","id":"20200709-135440_968546804","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:183"},{"text":"\n%pyspark\n\nspark.sql(\"select * from customer360.view_customer360_current_extsv_iponweb\").columns\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:35+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"col_name":"string","data_type":"string","comment":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"['uid', 'activated_flag', 'cert_type', 'contact_language', 'ad_id', 'os_name', 'first_visit_trueid_in90', 'first_visit_iservice_in90', 'first_visit_truemusic_in90', 'first_visit_truetv_in90', 'first_visit_trueyou_in90', 'first_visit_trueidlite_in90', 'first_visit_ott_in90', 'source', 'created_datetime', 'updated_datetime', 'beha_bank_app_usage_bank_app_usage_cat', 'beha_bank_web_usage_bank_web_usage_cat', 'beha_social_instant_message_usage_social_instant_message_usage_cat', 'beha_social_mixed_feed_usage_social_mixed_feed_usage_cat', 'beha_social_photo_feed_usage_social_photo_feed_usage_cat', 'inte_accommodation_portal_booking_accommodation_portal_booking_cat', 'inte_acedemic_community_acedemic_community_cat', 'inte_acedemic_conference_acedemic_conference_cat', 'inte_acedemic_paper_acedemic_paper_cat', 'inte_audio_platform_streamer_audio_platform_streamer_cat', 'inte_audio_radio_streamer_audio_radio_streamer_cat', 'inte_bulk_import_bulk_import_cat', 'inte_chinese_content_chinese_content_cat', 'inte_chinese_web_chinese_web_cat', 'inte_coffee_lover_coffee_lover_cat', 'inte_concert_ticket_concert_ticket_cat', 'inte_cosmetic_brand_cosmetic_brand_cat', 'inte_cosmetic_online_store_cosmetic_online_store_cat', 'inte_cosmetic_surgery_cosmetic_surgery_cat', 'inte_ecommerce_website_building_ecommerce_website_building_cat', 'inte_event_meetup_platform_event_meetup_platform_cat', 'inte_fashion_apparel_fashion_apparel_cat', 'inte_feminine_content_feminine_content_cat', 'inte_flight_portal_airline_flight_portal_airline_cat', 'inte_flight_portal_booking_flight_portal_booking_cat', 'inte_generic_online_store_generic_online_store_cat', 'inte_generic_wholesale_store_generic_wholesale_store_cat', 'inte_healthcare_content_healthcare_content_cat', 'inte_jobs_search_jobs_search_cat', 'inte_movie_ticket_interest_movie_ticket_interest_cat', 'inte_online_learning_online_learning_cat', 'inte_pet_lover_pet_lover_cat', 'inte_securities_broker_site_securities_broker_site_cat', 'inte_securities_news_securities_news_cat', 'inte_sme_equipment_sme_equipment_cat', 'inte_sme_information_sme_information_cat', 'inte_sme_management_system_sme_management_system_cat', 'inte_sme_placement_design_sme_placement_design_cat', 'inte_travel_information_travel_information_cat', 'inte_video_freetv_streamer_video_freetv_streamer_cat', 'inte_video_mixfm_streamer_video_mixfm_streamer_cat', 'inte_video_movie_streamer_video_movie_streamer_cat', 'inte_video_pirate_streamer_video_pirate_streamer_cat', 'inte_video_porn_streamer_video_porn_streamer_cat', 'inte_website_seo_service_website_seo_service_cat', 'demo_japanese_resident_japanese_resident_bin', 'demo_blocklist_blocklist_bin', 'beha_international_traveler_international_traveler_bin', 'geog_distance_home_work_distance_home_work_cat', 'beha_social_professional_feed_usage_social_professional_feed_usage_cat', 'inte_acedemic_institute_acedemic_institute_cat', 'inte_basketball_content_basketball_content_cat', 'inte_highend_japanese_food_highend_japanese_food_cat', 'inte_highend_restaurant_highend_restaurant_cat', 'inte_japanese_content_japanese_content_cat', 'inte_kids_5_8yo_kids_5_8yo_cat', 'inte_luxury_hotel_thailand_luxury_hotel_thailand_cat', 'inte_music_business_and_festival_music_business_and_festival_cat', 'inte_music_forum_and_news_music_forum_and_news_cat', 'inte_music_niche_music_niche_cat', 'inte_parents_parents_cat', 'inte_shorten_url_shorten_url_cat', 'inte_toddler_toddler_cat', 'beha_mobile_data_usage_monthly_data_usage_grp_cat', 'demo_handset_monthly_handset_grp_cat', 'demo_payment_monthly_payment_group_cat', 'geog_resident_location_sub_district_en_cat', 'geog_resident_location_district_en_cat', 'geog_resident_location_province_en_cat', 'geog_work_location_sub_district_en_cat', 'geog_work_location_district_en_cat', 'geog_work_location_province_en_cat', 'inte_standard_label_all_cat', 'inte_standard_label_arts_and_entertainment_animation_and_comics_cat', 'inte_standard_label_arts_and_entertainment_arts_and_entertainment_cat', 'inte_standard_label_arts_and_entertainment_books_and_literature_cat', 'inte_standard_label_arts_and_entertainment_humor_cat', 'inte_standard_label_arts_and_entertainment_music_cat', 'inte_standard_label_arts_and_entertainment_performing_arts_cat', 'inte_standard_label_arts_and_entertainment_tv_movies_and_streaming_cat', 'inte_standard_label_arts_and_entertainment_visual_arts_and_design_cat', 'inte_standard_label_business_and_consumer_services_business_and_consumer_services_cat', 'inte_standard_label_business_and_consumer_services_business_services_cat', 'inte_standard_label_business_and_consumer_services_marketing_and_advertising_cat', 'inte_standard_label_business_and_consumer_services_online_marketing_cat', 'inte_standard_label_business_and_consumer_services_publishing_and_printing_cat', 'inte_standard_label_business_and_consumer_services_real_estate_cat', 'inte_standard_label_business_and_consumer_services_shipping_and_logistics_cat', 'inte_standard_label_business_and_consumer_services_textiles_cat', 'inte_standard_label_community_and_society_decease_cat', 'inte_standard_label_community_and_society_holidays_and_seasonal_events_cat', 'inte_standard_label_community_and_society_romance_and_relationships_cat', 'inte_standard_label_computers_electronics_and_technology_advertising_networks_cat', 'inte_standard_label_computers_electronics_and_technology_computer_hardware_cat', 'inte_standard_label_computers_electronics_and_technology_computer_security_cat', 'inte_standard_label_computers_electronics_and_technology_computers_electronics_and_technology_cat', 'inte_standard_label_computers_electronics_and_technology_consumer_electronics_cat', 'inte_standard_label_computers_electronics_and_technology_email_cat', 'inte_standard_label_computers_electronics_and_technology_file_sharing_and_hosting_cat', 'inte_standard_label_computers_electronics_and_technology_graphics_multimedia_and_web_design_cat', 'inte_standard_label_computers_electronics_and_technology_programming_and_developer_software_cat', 'inte_standard_label_computers_electronics_and_technology_search_engines_cat', 'inte_standard_label_computers_electronics_and_technology_social_networks_and_online_communities_cat', 'inte_standard_label_computers_electronics_and_technology_web_hosting_and_domain_names_cat', 'inte_standard_label_e_commerce_and_shopping_auctions_cat', 'inte_standard_label_e_commerce_and_shopping_classifieds_cat', 'inte_standard_label_e_commerce_and_shopping_coupons_and_rebates_cat', 'inte_standard_label_e_commerce_and_shopping_e_commerce_and_shopping_cat', 'inte_standard_label_e_commerce_and_shopping_marketplace_cat', 'inte_standard_label_e_commerce_and_shopping_price_comparison_cat', 'inte_standard_label_e_commerce_and_shopping_tickets_cat', 'inte_standard_label_finance_accnting_and_auditing_cat', 'inte_standard_label_finance_banking_credit_and_lending_cat', 'inte_standard_label_finance_finance_cat', 'inte_standard_label_finance_financial_planning_and_management_cat', 'inte_standard_label_finance_insurance_cat', 'inte_standard_label_finance_investing_cat', 'inte_standard_label_food_and_drink_beverages_cat', 'inte_standard_label_food_and_drink_cooking_and_recipes_cat', 'inte_standard_label_food_and_drink_food_and_drink_cat', 'inte_standard_label_food_and_drink_groceries_cat', 'inte_standard_label_food_and_drink_restaurants_and_delivery_cat', 'inte_standard_label_food_and_drink_vegetarian_and_vegan_cat', 'inte_standard_label_gambling_bingo_cat', 'inte_standard_label_gambling_casinos_cat', 'inte_standard_label_gambling_gambling_cat', 'inte_standard_label_gambling_lottery_cat', 'inte_standard_label_gambling_poker_cat', 'inte_standard_label_gambling_sports_betting_cat', 'inte_standard_label_games_board_and_card_games_cat', 'inte_standard_label_games_puzzles_and_brainteasers_cat', 'inte_standard_label_games_roleplaying_games_cat', 'inte_standard_label_games_video_games_consoles_and_accessories_cat', 'inte_standard_label_health_addictions_cat', 'inte_standard_label_health_alternative_and_natural_medicine_cat', 'inte_standard_label_health_biotechnology_and_pharmaceuticals_cat', 'inte_standard_label_health_childrens_health_cat', 'inte_standard_label_health_dentist_and_dental_services_cat', 'inte_standard_label_health_health_cat', 'inte_standard_label_health_health_conditions_and_concerns_cat', 'inte_standard_label_health_medicine_cat', 'inte_standard_label_health_mens_health_cat', 'inte_standard_label_health_mental_health_cat', 'inte_standard_label_health_nutrition_and_fitness_cat', 'inte_standard_label_health_nutrition_diets_and_fitness_cat', 'inte_standard_label_health_pharmacy_cat', 'inte_standard_label_health_public_health_and_safety_cat', 'inte_standard_label_health_womens_health_cat', 'inte_standard_label_heavy_industry_and_engineering_aerospace_and_defense_cat', 'inte_standard_label_heavy_industry_and_engineering_agriculture_cat', 'inte_standard_label_heavy_industry_and_engineering_architecture_cat', 'inte_standard_label_heavy_industry_and_engineering_chemical_industry_cat', 'inte_standard_label_heavy_industry_and_engineering_construction_and_maintenance_cat', 'inte_standard_label_heavy_industry_and_engineering_energy_industry_cat', 'inte_standard_label_heavy_industry_and_engineering_heavy_industry_and_engineering_cat', 'inte_standard_label_heavy_industry_and_engineering_metals_and_mining_cat', 'inte_standard_label_hobbies_and_leisure_ancestry_and_genealogy_cat', 'inte_standard_label_hobbies_and_leisure_antiques_and_collectibles_cat', 'inte_standard_label_hobbies_and_leisure_camping_scouting_and_outdoors_cat', 'inte_standard_label_hobbies_and_leisure_crafts_cat', 'inte_standard_label_hobbies_and_leisure_models_cat', 'inte_standard_label_hobbies_and_leisure_photography_cat', 'inte_standard_label_home_and_garden_furniture_cat', 'inte_standard_label_home_and_garden_gardening_cat', 'inte_standard_label_home_and_garden_home_and_garden_cat', 'inte_standard_label_home_and_garden_home_improvement_and_maintenance_cat', 'inte_standard_label_home_and_garden_interior_design_cat', 'inte_standard_label_jobs_and_career_jobs_and_employment_cat', 'inte_standard_label_law_and_government_government_cat', 'inte_standard_label_law_and_government_immigration_and_visas_cat', 'inte_standard_label_law_and_government_law_and_government_cat', 'inte_standard_label_law_and_government_law_enforcement_and_protective_services_cat', 'inte_standard_label_law_and_government_legal_cat', 'inte_standard_label_law_and_government_national_security_cat', 'inte_standard_label_lifestyle_childcare_cat', 'inte_standard_label_lifestyle_fashion_and_apparel_cat', 'inte_standard_label_lifestyle_gifts_and_flowers_cat', 'inte_standard_label_lifestyle_jewelry_and_luxury_products_cat', 'inte_standard_label_lifestyle_lifestyle_cat', 'inte_standard_label_lifestyle_tobacco_cat', 'inte_standard_label_lifestyle_weddings_cat', 'inte_standard_label_pets_and_animals_fish_and_aquaria_cat', 'inte_standard_label_pets_and_animals_horses_cat', 'inte_standard_label_pets_and_animals_pet_food_and_supplies_cat', 'inte_standard_label_pets_and_animals_pets_and_animals_cat', 'inte_standard_label_pets_and_animals_pets_cat', 'inte_standard_label_reference_materials_dictionaries_and_encyclopedias_cat', 'inte_standard_label_reference_materials_maps_cat', 'inte_standard_label_reference_materials_public_records_and_directories_cat', 'inte_standard_label_reference_materials_reference_materials_cat', 'inte_standard_label_science_and_education_astronomy_cat', 'inte_standard_label_science_and_education_biology_cat', 'inte_standard_label_science_and_education_business_training_cat', 'inte_standard_label_science_and_education_chemistry_cat', 'inte_standard_label_science_and_education_colleges_and_universities_cat', 'inte_standard_label_science_and_education_earth_sciences_cat', 'inte_standard_label_science_and_education_education_cat', 'inte_standard_label_science_and_education_environmental_science_cat', 'inte_standard_label_science_and_education_grants_scholarships_and_financial_aid_cat', 'inte_standard_label_science_and_education_history_cat', 'inte_standard_label_science_and_education_libraries_and_museums_cat', 'inte_standard_label_science_and_education_math_cat', 'inte_standard_label_science_and_education_physics_cat', 'inte_standard_label_science_and_education_public_records_and_directories_cat', 'inte_standard_label_science_and_education_science_and_education_cat', 'inte_standard_label_science_and_education_social_sciences_cat', 'inte_standard_label_science_and_education_weather_cat', 'inte_standard_label_sports_american_football_cat', 'inte_standard_label_sports_baseball_cat', 'inte_standard_label_sports_basketball_cat', 'inte_standard_label_sports_boxing_cat', 'inte_standard_label_sports_cycling_and_biking_cat', 'inte_standard_label_sports_extreme_sports_cat', 'inte_standard_label_sports_fantasy_sports_cat', 'inte_standard_label_sports_fishing_cat', 'inte_standard_label_sports_golf_cat', 'inte_standard_label_sports_hunting_and_shooting_cat', 'inte_standard_label_sports_martial_arts_cat', 'inte_standard_label_sports_running_cat', 'inte_standard_label_sports_soccer_cat', 'inte_standard_label_sports_sports_cat', 'inte_standard_label_sports_tennis_cat', 'inte_standard_label_sports_volleyball_cat', 'inte_standard_label_sports_water_sports_cat', 'inte_standard_label_travel_and_tourism_accommodation_and_hotels_cat', 'inte_standard_label_travel_and_tourism_air_travel_cat', 'inte_standard_label_travel_and_tourism_car_rentals_cat', 'inte_standard_label_travel_and_tourism_ground_transportation_cat', 'inte_standard_label_travel_and_tourism_tourist_attractions_cat', 'inte_standard_label_travel_and_tourism_transportation_and_excursions_cat', 'inte_standard_label_travel_and_tourism_travel_and_tourism_cat', 'inte_standard_label_vehicles_automotive_industry_cat', 'inte_standard_label_vehicles_aviation_cat', 'inte_standard_label_vehicles_boats_cat', 'inte_standard_label_vehicles_makes_and_models_cat', 'inte_standard_label_vehicles_motorcycles_cat', 'inte_standard_label_vehicles_motorsports_cat', 'inte_standard_label_vehicles_vehicles_cat', 'beha_credit_card_app_usage_credit_card_app_usage_cat', 'beha_online_forum_community_online_forum_community_cat', 'beha_social_video_feed_usage_social_video_feed_usage_cat', 'demo_age_fact_final_age_num', 'demo_gender_fog_final_gender_bin', 'inte_chain_restuarant_chain_restuarant_cat', 'inte_banking_bank_commercial_banking_bank_commercial_cat', 'inte_banking_bank_gov_banking_bank_gov_cat', 'inte_banking_bank_international_banking_bank_international_cat', 'inte_car_rental_car_rental_cat', 'inte_fashion_cosmetic_store_fashion_cosmetic_store_cat', 'inte_ecommerce_consumer_electronics_brand_ecommerce_consumer_electronics_brand_cat', 'inte_ecommerce_consumer_electronics_retail_ecommerce_consumer_electronics_retail_cat', 'inte_ecommerce_coupons_and_rebates_ecommerce_coupons_and_rebates_cat', 'inte_ecommerce_marketplace_ecommerce_marketplace_cat', 'inte_education_international_school_education_international_school_cat', 'inte_education_university_student_education_university_student_cat', 'inte_entertainment_cinema_entertainment_cinema_cat', 'inte_entertainment_movies_and_series_streaming_entertainment_movies_and_series_streaming_cat', 'inte_entertainment_music_lyric_entertainment_music_lyric_cat', 'inte_entertainment_music_streaming_entertainment_music_streaming_cat', 'inte_entertainment_news_entertainment_news_cat', 'inte_entertainment_radio_streamer_entertainment_radio_streamer_cat', 'inte_entertainment_tv_channel_entertainment_tv_channel_cat', 'inte_finance_accnting_and_auditing_finance_accnting_and_auditing_cat', 'inte_finance_credit_finance_credit_cat', 'inte_finance_digital_currency_finance_digital_currency_cat', 'inte_finance_digital_payment_finance_digital_payment_cat', 'inte_finance_financial_planner_finance_financial_planner_cat', 'inte_finance_investment_finance_investment_cat', 'inte_finance_personal_finance_finance_personal_finance_cat', 'inte_food_junkfood_lover_food_junkfood_lover_cat', 'inte_gaming_gamer_gaming_gamer_cat', 'inte_healthcare_gym_healthcare_gym_cat', 'inte_healthcare_health_conditions_and_concerns_healthcare_health_conditions_and_concerns_cat', 'inte_healthcare_hospital_healthcare_hospital_cat', 'inte_healthcare_nutrition_and_fittness_healthcare_nutrition_and_fittness_cat', 'inte_insurance_insurance_broker_insurance_insurance_broker_cat', 'inte_insurance_insurance_life_insurance_insurance_life_cat', 'inte_insurance_insurance_nonlife_insurance_insurance_nonlife_cat', 'inte_lifestage_baby_lifestage_baby_cat', 'inte_lifestage_pregnancy_lifestage_pregnancy_cat', 'inte_marketing_marketing_and_advertising_marketing_marketing_and_advertising_cat', 'inte_occupation_freelance_occupation_freelance_cat', 'inte_realestate_real_estate_agents_realestate_real_estate_agents_cat', 'inte_realestate_real_estate_content_realestate_real_estate_content_cat', 'inte_realestate_real_estate_developer_realestate_real_estate_developer_cat', 'inte_sport_badminton_sport_badminton_cat', 'inte_sport_basketball_sport_basketball_cat', 'inte_sport_bicycle_sport_bicycle_cat', 'inte_sport_boxing_sport_boxing_cat', 'inte_sport_fishing_sport_fishing_cat', 'inte_sport_football_lover_sport_football_lover_cat', 'inte_sport_golf_sport_golf_cat', 'inte_sport_mixsport_sport_mixsport_cat', 'inte_sport_running_sport_running_cat', 'inte_sport_shooting_sport_shooting_cat', 'inte_sport_tennis_sport_tennis_cat', 'inte_sport_volleyball_sport_volleyball_cat', 'inte_telco_telecommunications_telco_telecommunications_cat', 'inte_travel_accommodation_and_hotels_travel_accommodation_and_hotels_cat', 'inte_travel_air_travel_travel_air_travel_cat', 'inte_travel_travel_content_travel_travel_content_cat', 'inte_travel_travel_multiservices_travel_travel_multiservices_cat', 'inte_video_sharing_streamer_video_sharing_streamer_cat', 'inte_automotive_car_brand_automotive_car_brand_cat', 'inte_automotive_car_content_automotive_car_content_cat', 'inte_automotive_car_repair_automotive_car_repair_cat', 'inte_automotive_motorcycle_lover_automotive_motorcycle_lover_cat', 'inte_discnt_seekers_privilege_and_rewards_discnt_seekers_privilege_and_rewards_cat', 'inte_logistic_food_delivery_logistic_food_delivery_cat', 'inte_logistic_goods_delivery_logistic_goods_delivery_cat', 'inte_telcolabel_tol_competitor_telcolabel_tol_competitor_cat', 'demo_handset_monthly_clean_os_cat', 'demo_handset_monthly_device_type_cat']\n"}]},"apps":[],"jobName":"paragraph_1599544355670_-1817079477","id":"20200630-002254_1277536024","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:184"},{"text":"%pyspark\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:35+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544355763_725597914","id":"20200709-184957_436399973","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:185"},{"text":"%pyspark\n\n\nxx = spark.read.orc(\"/trueanalytics/data/datasci/customer360_dev/smith_dev/clm_grid_06_compact\")\n\nz.show(xx.groupBy(\"lifestage_final\").agg(count(\"msisdn\")))","user":"thatchaphon_kae","dateUpdated":"2020-11-12T17:49:55+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"lifestage_final":"string","count(msisdn)":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"lifestage_final","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count(msisdn)","index":1,"aggr":"sum"}]},"helium":{}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"lifestage_final\tcount(msisdn)\nexperiencedprofessional_urban\t1227345\nhighschool\t2955965\nuniversity\t2031376\nother\t12710707\nestablishedfamily\t1635379\nstartcareer\t1934931\nfamilywithtoddler\t1534326\nexperiencedprofessional_rural\t3304063\nheavyduty\t2574087\nfamilywithgrownupkid\t1212907\nretirement\t1913386\n"},{"type":"TEXT","data":"\n"}]},"apps":[],"jobName":"paragraph_1599544355853_-739427739","id":"20200708-114217_83526810","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:186"},{"text":"%pyspark\n","user":"thatchaphon_kae","dateUpdated":"2020-09-08T12:52:36+0700","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1599544355943_1118292844","id":"20200708-172958_293993795","dateCreated":"2020-09-08T12:52:35+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:187"}],"name":"user/nathaniel_net/research/age_model/postpaid_group_1234_final","id":"2FKC8PHKM","noteParams":{},"noteForms":{},"angularObjects":{"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":true,"looknfeel":"default","personalizedMode":"false"},"info":{}}